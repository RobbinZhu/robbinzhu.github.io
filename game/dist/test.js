!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){"use strict";i.r(e);class n{constructor(){}init(t,e,i,n){return this.x=t,this.y=e,this.identifier=n,this.type=i,this}remove(){n.collect(this)}}const s=[];n.create=function(t,e,i,h){return(s.length?s.pop():new n).init(t,e,i,h)},n.collect=function(t){s.push(t)},n.clean=function(t){s.length=0};var h=n;class r{constructor(){}init(t,e){return this.code=t,this.type=e,this}remove(){this.code=null,this.type=null,r.collect(this)}}const o=[];r.create=function(t,e){return(o.length?o.pop():new r).init(t,e)},r.collect=function(t){o.push(t)};var a=r;const c="undefined"!=typeof ejecta,u={touchstart:"touch",touchmove:"touch",touchend:"touch",touchcancel:"touch",keydown:"key",keypress:"key",keyup:"key"},l=["touchstart","touchmove","touchend","touchcancel"],d=["keydown","keypress","keyup"],p={passive:!0};const m=[],f={};let y={};function g(t){c?delete f[t]:f[t]=null}const v=[],x={touch:function(t,e){const i=e.display.scaleRatio,n=e.getTransform();for(let e=0,s=t.changedTouches.length;e<s;e++){const s=t.changedTouches[e],r=s.identifier,o=h.create(n.a*s.clientX*i+n.e,n.d*s.clientY*i+n.f,t.type,r);switch(t.type){case"touchstart":f[r]=o;const e=m.length;let i=0;for(;i<e;){if(null==m[i]){m[i]=o;break}i++}i==e&&m.push(o);break;case"touchmove":if(f[r]){const t=m.indexOf(f[r]);t>-1&&(m[t].remove(),m[t]=o),f[r]=o}break;case"touchend":case"touchcancel":if(f[r]){const t=m.indexOf(f[r]);t>-1&&(m[t].remove(),m[t]=null),g(r)}}}},key:function(t,e){const i=t.which||t.keyCode;if(void 0!==y[i])switch(t.type){case"keydown":y[i]||(y[i]=a.create(i,t.type));break;case"keyup":y[i]&&(y[i].remove(),y[i]=null)}}};function C(t,e,i){for(let n=e.length-1;n>=0;n--)t.addEventListener(e[n],i,p)}function w(t,e,i){for(let n=e.length-1;n>=0;n--)t.removeEventListener(e[n],i,p)}class b{constructor(){}init(t,e){return this.session=e,this.filter=this.filter.bind(this),this.dom=t,this}listenTouchEvents(){return this.stopListenTouchEvents(),C(this.dom,l,this.filter),this}listenKeyEvents(t){return v.length=0,y={},t.forEach(function(t){v.push(t),y[t]=null}),this.stopListenKeyEvents(),C(this.dom,d,this.filter),this}stopListen(){return this.stopListenKeyEvents().stopListenTouchEvents()}stopListenTouchEvents(){return w(this.dom,l,this.filter),this}stopListenKeyEvents(){return w(this.dom,d,this.filter),this}remove(){this.resetTouchEvents(),this.resetKeyEvents(),this.stopListen(),this.filter=null,this.dom=null,this.session=null}filter(t){x[u[t.type]](t,this.session)}getKeyEvents(){return y}getTouchEvents(){let t=!0;for(let e=m.length-1;e>=0;e--)if(m[e]){t=!1;break}return t&&(m.length=0),m}}b.prototype.resetTouchEvents=function(){for(let t=0,e=m.length;t<e;t++)m[t]&&m[t].remove();m.length=0},b.prototype.resetKeyEvents=function(){},b.prototype.reset=function(){return this};const T=[];b.create=function(t,e){return(T.length?T.pop():new b).init(t,e)},b.collect=function(t){T.push(t)},b.clean=function(){T.length=0};var A=b;class M{init(t,e){return this.update(t,e)}clone(){return M.create(this.x,this.y)}update(t,e){return this.x=t,this.y=e,this}set(t){return this.x=t.x,this.y=t.y,this}negate(){return this.x=-this.x,this.y=-this.y,this}distance(t){return Math.sqrt(this.sqrtDistance(t))}sqrtDistance(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}normalize(){const t=1/this.length();return this.x*=t,this.y*=t,this}length(){return Math.sqrt(this.sqrtLength())}sqrtLength(){return this.x*this.x+this.y*this.y}add(t){return this.addxy(t.x,t.y)}addxy(t,e){return this.x+=t,this.y+=e,this}substract(t){return this.substractxy(t.x,t.y)}substractxy(t,e){return this.x-=t,this.y-=e,this}multiply(t){return this.x*=t,this.y*=t,this}devide(t){return this.multiply(1/t)}dot(t){return this.dotxy(t.x,t.y)}dotxy(t,e){return this.x*t+this.y*e}cross(t){return this.crossxy(t.x,t.y)}crossxy(t,e){return this.x*e-this.y*t}rotate(t,e,i){return this.rotateWithSinCos(Math.sin(t),Math.cos(t),e,i)}rotateWithSinCos(t,e,i,n){let s=this.x,h=this.y;return s-=i,h-=n,this.x=e*s+t*h+i,this.y=-t*s+e*h+n,this}angleTo(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}transform(t){const e=this.x,i=this.y;return this.x=t.a*e+t.c*i+t.e,this.y=t.b*e+t.d*i+t.f,this}remove(){M.collect(this)}normal(){return M.create(this.y,-this.x)}major(){return Math.abs(this.x)>Math.abs(this.y)?M.create(this.x>=0?1:-1,0):M.create(0,this.y>=0?1:-1)}lerp(t,e){return e=Math.max(0,Math.min(1,e)),this.addxy((t.x-this.x)*e,(t.y-this.y)*e),this}lerpNoClamp(t,e){return this.addxy((t.x-this.x)*e,(t.y-this.y)*e),this}moveTowards(t,e){const i=t.x-this.x,n=t.y-this.y,s=Math.sqrt(i*i+n*n);if(!(s<=e||0==s)){const t=e/s;this.x+=i*t,this.y+=n*t}return this}}function R(t,e,i){return t<e?t=e:t>i&&(t=i),t}M.SmoothDampVector=function(t,e,i,n,s,h,r){const o=2/(n=Math.max(1e-4,n)),a=o*s,c=1/(1+a+.48*a*a+.235*a*a*a);let u=t.x-e.x,l=t.y-e.y;const d=h.x*n,p=h.y*n;u=R(u,-d,d),l=R(l,-p,p);const m=t.x-u,f=t.y-l,y=(i.x+o*u)*s,g=(i.y+o*l)*s;i.x=(i.x-o*y)*c,i.y=(i.y-o*g)*c;let v=m+(u+y)*c,x=f+(l+g)*c;e.x-t.x>0==r.x>e.x&&(v=e.x,i.x=(v-e.x)/s),e.y-t.y>0==r.y>e.y&&(x=e.y,i.y=(v-e.y)/s),r.x=v,r.y=x};const S=[];M.create=function(t,e){return(S.length?S.pop():new M).init(t,e)},M.collect=function(t){S.push(t)},M.clean=function(){S.length=0};var k=M;class _{constructor(){}update(t,e,i,n,s,h){return this.a=t,this.b=e,this.c=i,this.d=n,this.e=s,this.f=h,this}clone(){return _.create(this.a,this.b,this.c,this.d,this.e,this.f)}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}rotate(t){return this.rotateWithSinCos(Math.sin(t),Math.cos(t))}rotateWithRotation(t){return this.rotateWithSinCos(t.sin,t.cos)}rotateWithSinCos(t,e){const i=this.a,n=this.b,s=this.c,h=this.d;return this.a=i*e+s*t,this.b=n*e+h*t,this.c=-i*t+s*e,this.d=-n*t+h*e,this}skew(t,e){const i=this.a,n=this.b,s=this.c,h=this.d;return t=Math.tan(t),e=Math.tan(e),this.a+=s*t,this.b+=h*t,this.c+=i*e,this.d+=n*e,this}transform(t,e,i,n,s,h){const r=this.a,o=this.b,a=this.c,c=this.d,u=this.e,l=this.f;return this.a=r*t+a*e,this.b=o*t+c*e,this.c=r*i+a*n,this.d=o*i+c*n,this.e=r*s+a*h+u,this.f=o*s+c*h+l,this}transformSomeMatrixTo(t,e){const i=this.a,n=this.b,s=this.c,h=this.d,r=this.e,o=this.f,a=t.a,c=t.b,u=t.c,l=t.d,d=t.e,p=t.f;let m=i*h-n*s;return m=0==m?1:1/m,e.update((h*a-s*c)*m,(n*a-i*c)*-m,(h*u-s*l)*m,(n*u-i*l)*-m,(s*(o-p)+h*(d-r))*m,(i*(o-p)+n*(d-r))*-m)}transformMatrix(t){return this.transform(t.a,t.b,t.c,t.d,t.e,t.f)}transformMatrixTo(t,e){const i=this.a,n=this.b,s=this.c,h=this.d,r=this.e,o=this.f,a=t.a,c=t.b,u=t.c,l=t.d,d=t.e,p=t.f;return e.a=i*a+s*c,e.b=n*a+h*c,e.c=i*u+s*l,e.d=n*u+h*l,e.e=i*d+s*p+r,e.f=n*d+h*p+o,e}transformVector(t){return t.transform(this)}inverse(){return this.inverseTo(this)}inverseTo(t){const e=this.a,i=this.b,n=this.c,s=this.d,h=this.e,r=this.f,o=1/(e*s-i*n);return t.a=s*o,t.b=-i*o,t.c=-n*o,t.d=e*o,t.e=(n*r-s*h)*o,t.f=(i*h-e*r)*o,t}reset(){return this.update(1,0,0,1,0,0)}set(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this}equal(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f}remove(){_.collect(this)}toString(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}}const E=[];_.create=function(t,e,i,n,s,h){return(E.length?E.pop():new _).update(t,e,i,n,s,h)},_.collect=function(t){E.push(t)},_.clean=function(){E.length=0};var q=_;class I{constructor(){}update(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this.x2=t+i,this.y2=e+n,this}compute(t,e,i,n,s,h,r,o,a,c){const u=-(t-=s)*r,l=t*o,d=(t+i)*o,p=(e-=h)*r,m=e*o,f=(e+n)*r,y=(e+n)*o,g=(l+p)*a,v=(d+p)*c,x=(l+f)*a,C=(d+f)*c,w=(u+m)*a,b=(f+m)*c,T=(u+y)*a,A=(-(t+i)*r+y)*c,M=Math.min(g,v,x,C),R=Math.max(g,v,x,C),S=Math.min(w,b,T,A),k=Math.max(w,b,T,A);return this.x=M+s,this.y=S+h,this.x2=R+s,this.y2=k+h,this.width=R-M,this.height=k-S,this}collide(t){return!(t.x>this.x2||t.y>this.y2||t.x2<this.x||t.y2<this.y)}contains(t,e){return this.x<=t&&t<=this.x2&&this.y<=e&&e<=this.y2}remove(){I.collect(this)}}const L=[];I.create=function(t,e,i,n){return(L.length?L.pop():new I).update(t,e,i,n)},I.collect=function(t){L.push(t)},I.clean=function(t){L.length=0};var O=I;const U={width:-1,height:-1,scaleRatio:-1};var F=function(t){const e=window.devicePixelRatio;let i=window.innerWidth,n=window.innerHeight;return t.style.width=i+"px",t.style.height=n+"px",i*=e,n*=e,i|=0,n|=0,t.width=i,t.height=n,U.width=i,U.height=n,U.scaleRatio=e,U};const P={},z=Array.prototype.slice;function j(t,e,i){return P[e]||(P[e]=[]),P[e].push({host:t,fn:i}),this}function H(t,e,i){if(e){if(!P[e])return this;const n=P[e];if(i){for(let s=n.length-1;s>=0;s--){const h=n[s];h.fn===i&&(null!==t&&h.host!==t||P[e].splice(s,1))}return this}for(let i=n.length-1;i>=0;i--){const s=n[i];null!==t&&s.host!==t||P[e].splice(i,1)}return this}const n=Object.keys(P),s=n.length;for(let e=0;e<s;e++){const i=P[n[e]];for(let n=i.length-1;n>=0;n--){const n=i[e];n&&n.host===t&&i.splice(e,1)}}return this}function W(t){if(!P[t])return;const e=z.call(arguments,1);for(let i=0,n=P[t].length;i<n;i++){const n=P[t][i];n.fn.apply(n.host,e)}return this}var K={on:j,sub:j,off:H,unsub:H,emit:W,pub:W,inspect:function(){return P}};class D{constructor(){}on(){K.on.apply(this,arguments)}off(){K.off(this)}init(t,e,i,n){return this.display={canvas:t,ctx:t.getContext("2d"),resolution:k.create(0,0),width:0,height:0,baseTransform:q.create(1,0,0,1,0,0),_baseTransformI:q.create(1,0,0,1,0,0),scaleRatio:1},this.domEvent=A.create(t,this),this.domEvent.listenTouchEvents(),this.design={resolution:k.create(0,0),width:0,height:0},this.currentTime=0,this.frameNumber=60,this.frameCount=0,this.frameRefreshCount=0,this}getTransform(){return this.display.baseTransform}resize(){const t=F(this.display.canvas);this.display.width=t.width,this.display.height=t.height,this.display.scaleRatio=t.scaleRatio;const e=t.width,i=t.height,n=this.design.width,s=this.design.height;let h;const r=n*(h=e/i>n/s?i/s:e/n)-e,o=s*h-i;this.display.baseTransform.update(1/h,0,0,1/h,1/h*r*.5,1/h*o*.5),this.display._baseTransformI.update(h,0,0,h,.5*-r,.5*-o)}clear(){this.display.ctx.setTransform(1,0,0,1,0,0),this.display.ctx.clearRect(0,0,this.display.width,this.display.height)}setTransform(t,e,i,n,s,h){this.display.ctx.setTransform(t,e,i,n,s,h)}computeRenderCost(){const t=Date.now();if(this.currentTime>0){const e=t-this.currentTime;this.frameRefreshCount+=e,++this.frameCount>=59&&(this.frameNumber=(6e4/this.frameRefreshCount).toFixed(1),this.frameCount=0,this.frameRefreshCount=0)}this.currentTime=t}renderFPS(){this.computeRenderCost();const t=this.display.ctx;t.setTransform(1,0,0,1,0,0),t.globalAlpha=1,t.font=32*this.display.scaleRatio+"px Arail",t.fillStyle="red",t.textAlign="start",t.textBaseline="top",t.fillText(this.frameNumber,0,0)}drawImage(t,e,i,n,s,h,r,o,a){return this.display.ctx.drawImage(t,e,i,n,s,h,r,o,a),this}draw(t,e,i,n,s){if(!t)return;const h=this.display.ctx;h.fillStyle=t,h.fillRect(e,i,n,s)}setDrawInfo(t,e){this.display.ctx.setTransform(t.a,t.b,t.c,t.d,t.e,t.f),this.display.ctx.globalAlpha=e}setResolution(t,e){this.design.resolution.update(t,e),this.design.width=t,this.design.height=e,this.resize()}remove(){this.off()}}const N=[];D.create=function(t,e,i,n){return(N.length?N.pop():new D).init(t,e,i,n)},D.collect=function(t){N.push(t)},D.clean=function(){N.length=0};var B=D;class G{constructor(){}init(t){return this.host=t,this}pub(){return K.pub.apply(null,arguments),this}on(t,e){return K.on(this.host,t,e),this}off(){return K.off(this.host),this}remove(){this.off(),this.host=null,G.collect(this)}}const V=[];G.create=function(t){return(V.length?V.pop():new G).init(t)},G.collect=function(t){V.push(t)},G.clean=function(){V.length=0};var X=G;function Y(t,e){return t.zIndex-e.zIndex}class J{constructor(){}init(){return this.children=[],this.parent=null,this.zIndex=0,this}update(){}addChild(t,e){const i=this.children;if(void 0===e)i.push(t);else{for(let t=i.length;t>e;t--)i[t]=i[t-1];i[e]=t}return t.parent=this,this}sortChildren(){return this.children.sort(Y),this}removeChild(t){return this.removeChildAt(this.children.indexOf(t))}removeChildAt(t){const e=this.children;e[t].remove();for(let i=t,n=e.length-1;i<n;i++)e[i]=e[i+1];return--e.length,this}removeChildren(){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].remove();return t.length=0,this}removeFromParent(){return this.parent&&this.parent.removeChild(this),this}remove(){this.removeChildren(),this.children=this.parent=null}}const Q=[];J.create=function(){return(Q.length?Q.pop():new J).init()},J.collect=function(t){Q.push(t)},J.clean=function(){Q.length=0};var Z=J;class ${constructor(){}init(t){return this.host=t,this.onUpdate=[],this.onRemove=[],this.afterUpdate=[],this}update(){return this}handleOnUpdate(){const t=arguments;for(let e=0,i=this.onUpdate.length;e<i;e++)this.onUpdate[e].apply(this.host,t)}handleAfterUpdate(){const t=arguments;for(let e=0,i=this.afterUpdate.length;e<i;e++)this.afterUpdate[e].apply(this.host,t)}handleOnRemove(){const t=arguments;for(let e=0,i=this.onRemove.length;e<i;e++)this.onRemove[e].apply(this.host,t)}remove(){this.handleOnRemove(),this.host=this.onUpdate=this.afterUpdate=this.onRemove=null,$.collect(this)}}const tt=[];$.create=function(t){return(tt.length?tt.pop():new $).init(t)},$.collect=function(t){tt.push(t)},$.clean=function(){tt.length=0};var et=$;function it(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,16.67)}}function nt(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFram||function(t){window.clearTimeout(t)}}const st=["interactive","loaded","complete"];var ht={domReady:new Promise(function(t,e){st.indexOf(document.readyState)>=0?t():function(t,e,i){t.addEventListener(e,i,{passive:!0})}(document,"DOMContentLoaded",t)}),visibilityChange:function(t){if("hidden"in document)document.addEventListener("visibilitychange",function(){t(document.hidden)},!1);else if("webkitHidden"in document)document.addEventListener("webkitvisibilitychange",function(){t(document.webkitHidden)},!1);else if("mozHidden"in document)document.addEventListener("mozvisibilitychange",function(){t(document.mozHidden)},!1);else{if(!("msHidden"in document))return!1;document.addEventListener("msvisibilitychange",function(){t(document.msHidden)},!1)}return!0},requestAnimFrame:it(),cancelAnimFrame:nt(),cancelTimeRequest:function(t){return nt(t.timeRequest)},setTimeRequest:function(t,e){if(e<=0)return t();let i=0;const n={timeRequest:it(function s(){++i==e?(t(),s=null,it=null,i=null):n.timeRequest=it(s)})};return n}};const rt=ht.requestAnimFrame,ot=ht.cancelAnimFrame;class at{constructor(){}init(t,e,i){return this.currentScene=null,this.nextScene=null,this.pubsubComponent=X.create(this),this.hookComponent=et.create(this),this.requestAnimId=null,this.session=B.create(t,this,e,i),this.updateCanvasSize(e,i),this.run=this.runLoop.bind(this),this.isPaused=!1,this}listenKeyEvents(){this.session.domEvent.listenKeyEvents.apply(this.session.domEvent,arguments)}updateCanvasSize(t,e){this.session.setResolution(t,e)}pause(){this.isPaused=!0}resume(){this.isPaused=!1}runLoop(){this.isPaused||this.update(this.session),this.render(this.session),this.requestAnimId=rt(this.run)}presentScene(t){this.currentScene=t}update(t){return this.hookComponent.handleOnUpdate(t),this.updateChildren(t,this.cameraComponent),this.hookComponent.handleAfterUpdate(t),this}updateChildren(t){this.currentScene&&this.currentScene.update(t),this.nextScene&&this.nextScene.update(t)}render(t){return t.clear(),this.currentScene&&this.currentScene.render(t),this.nextScene&&this.nextScene.render(t),this}remove(){ot(this.requestAnimId),this.hookComponent.remove(),this.pubsubComponent.remove(),this.currentScene&&this.currentScene.remove(),this.nextScene&&this.nextScene.remove(),this.session&&this.session.remove(),this.requestAnimId=this.hookComponent=this.pubsubComponent=this.currentScene=this.nextScene=this.session=this.run=null,at.collect(this)}}const ct=[];at.create=function(t,e,i){return(ct.length?ct.pop():new at).init(t,e,i)},at.collect=function(t){ct.push(t)},at.clean=function(){ct.length=0};var ut=at;class lt{constructor(){}init(){return this.texture=null,this.color=null,this.alpha=1,this.alphaComputed=1,this.width=0,this.height=0,this.notUseCamera=!0,this}update(){return this}prepareGraphicsInfo(t,e,i){this.alphaComputed=i*this.alpha,t.setDrawInfo(e,this.alphaComputed),this.width=100,this.height=100}render(t,e){this.texture?this.renderTexture(t,this.texture):this.draw(t,this.color)}renderTexture(t,e){t.drawImage(e.source,e.x,e.y,e.width,e.height,0,0,this.width,this.height)}draw(t,e){return t.draw(e,0,0,this.width,this.height),this}updateAlphaRatio(t){this.alphaComputed=this.alpha*t}remove(){this.texture=this.color=null,lt.collect(this)}}const dt=[];lt.create=function(){return(dt.length?dt.pop():new lt).init()},lt.collect=function(t){dt.push(t)},lt.clean=function(){dt.length=0};var pt=lt;class mt{constructor(){}init(t){return this.target=t,this.actions=[],this}update(t){for(let t=0,e=this.actions.length;t<e;t++){const e=this.actions[t];e&&e.update(16.66)}return this}remove(){for(let t=0,e=this.actions.length;t<e;t++){const e=this.actions[t];e&&e.remove()}this.actions.length=0,this.target=null,mt.collect(this)}runAction(t){return this.addAction(t),t.run(this.target),this}stopAction(t){return t.stop(),this}pauseAction(t){return t.pause(),this}resumeAction(t){return t.resume(),this}addAction(t){return this.actions.push(t),t.parent=this,this}removeAction(t){for(let e=0,i=this.actions.length;e<i;e++)if(this.actions[e]===t){for(i--;e<i;)this.actions[e]=this.actions[++e];this.actions.length=i;break}return t.remove(),this}}const ft=[];mt.create=function(t){return(ft.length?ft.pop():new mt).init(t)},mt.collect=function(t){ft.push(t)},mt.clean=function(){ft.length=0};var yt=mt;class gt{constructor(){}init(t){return this.actionManager=yt.create(t),this}update(t){this.actionManager.update(t)}remove(){this.actionManager.remove(),this.actionManager=null,gt.collect()}}const vt=[];gt.create=function(t){return(vt.length?vt.pop():new gt).init(t)},gt.collect=function(t){vt.push(t)},gt.clean=function(){vt.length=0};var xt=gt;class Ct{constructor(){}init(){return this}update(){}}const wt=[];Ct.create=function(){return(wt.length?wt.pop():new Ct).init()},Ct.collect=function(t){wt.push(t)},Ct.clean=function(){wt.length=0};var bt=Ct;class Tt{init(t,e){return this.frame=O.create(0,0,0,0),this.scale=k.create(1,1),this.position=k.create(0,0),this.width=t,this.height=e,this.halfWidth=t>>1,this.halfHeight=e>>1,this._matrix=q.create(1,0,0,1,0,0),this._matrixI=q.create(1,0,0,1,0,0),this.onlyUseTranslate=!0,this}update(t){this.updateMatrix(t)}updateSize(t){this.width=t.design.resolution.x,this.height=t.design.resolution.y,this.halfWidth=this.width>>1,this.halfHeight=this.height>>1}updateMatrix(t){const e=this.halfWidth,i=this.halfHeight;if(this.onlyUseTranslate){const t=this.position.x-e,n=this.position.y-i;this._matrix.update(1,0,0,1,t,n),this._matrixI.update(1,0,0,1,-t,-n),this.frame.update(t,n,this.width,this.height)}else{const t=this.scale.x,n=this.scale.y,s=this.position.x-t*e,h=this.position.y-t*i;this._matrix.update(t,0,0,n,s,h),this._matrixI.update(1!=t?1/t:1,0,0,1!=n?1/n:1,-s,-h),this.frame.update(s,h,this.width*t,this.height*n)}return t.display._baseTransformI.transformMatrixTo(this._matrixI,this._matrixI),this}remove(){this.scale.remove(),this.position.remove(),this._matrix.remove(),this._matrixI.remove(),this.frame.remove(),this.scale=this.position=this._matrix=this._matrixI=this.frame=null,this._collect()}_collect(){Tt.collect(this)}}const At=[];Tt.create=function(t,e){return(At.length?At.pop():new Tt).init(t,e)},Tt.collect=function(t){At.push(t)},Tt.clean=function(){At.length=0};var Mt=Tt;class Rt{constructor(){}clone(){return Rt.create(this.angle)}add(t){return this.update(this.angle+t)}set(t){return this.angle!=t&&this.update(t),this}reset(){return this.angle=0,this.sin=0,this.cos=1,this}update(t){return this.angle=t,this.sin=Math.sin(t),this.cos=Math.cos(t),this}remove(){Rt.collect(this)}}const St=[];Rt.create=function(t){return(St.length?St.pop():new Rt).update(t)},Rt.collect=function(t){St.push(t)},Rt.clean=function(){St.length=0};var kt=Rt;class _t{constructor(){}init(){return this.width=0,this.height=0,this.anchor=k.create(.5,.5),this.rotation=kt.create(0),this.scale=k.create(1,1),this.position=k.create(0,0),this.frame=O.create(0,0,0,0),this._matrix=q.create(1,0,0,1,0,0),this}update(t,e,i){const n=this._matrix;i?n.set(i):n.reset();const s=this.width*this.anchor.x,h=this.height*this.anchor.y,r=this.position.x,o=this.position.y,a=this.rotation.sin,c=this.rotation.cos,u=this.scale.x,l=this.scale.y,d=c*u,p=a*u,m=-a*l,f=c*l;return n.transform(d,p,m,f,d*-s+m*-h+r,p*-s+f*-h+o),this.frame.compute(r-s,o-h,this.width,this.height,r,o,a,c,u,l),this}remove(){this.anchor.remove(),this.rotation.remove(),this.scale.remove(),this.position.remove(),this.frame.remove(),this._matrix.remove(),this.anchor=this.rotation=this.scale=this.position=this.frame=this._matrix=null,_t.collect(this)}}const Et=[];_t.create=function(){return(Et.length?Et.pop():new _t).init()},_t.collect=function(t){Et.push(t)},_t.clean=function(){Et.length=0};var qt=_t;class It{constructor(){}init(t){return this.name=t,this.isPaused=!1,this.isActive=!0,this.pubsubComponent=X.create(this),this.hookComponent=et.create(this),this.nodeTreeComponent=Z.create(),this.graphicsComponent=pt.create(),this.spaceComponent=qt.create(),this.animationComponent=xt.create(this),this.inputComponent=bt.create(),this.cameraComponent=null,this}setCamera(t){return this.cameraComponent=t,this}pause(){this.isPaused=!0}resume(){this.isPaused=!1}active(){this.isActive=!0}deactive(){this.isActive=!1}update(t,e,i){return this.hookComponent.handleOnUpdate(t),this.animationComponent.update(t),this.isPaused||this.inputComponent.update(t,e),this.spaceComponent.update(t,e,i),this.graphicsComponent.update(t,e),this.nodeTreeComponent.update(t),this.updateChildren(t,e,this.spaceComponent._matrix),this.hookComponent.handleAfterUpdate(t),this}updateChildren(t,e,i){const n=this.nodeTreeComponent.children;for(let s=0,h=n.length;s<h;s++){const h=n[s];h&&h.isActive&&h.update(t,e,i)}}render(t,e,i){const n=this.spaceComponent._matrix;e&&!this.graphicsComponent.notUseCamera?e._matrixI.transformMatrixTo(n,n):t.display._baseTransformI.transformMatrixTo(n,n),this.graphicsComponent.prepareGraphicsInfo(t,n,i),this.graphicsComponent.render(t,e),this.renderChildren(t,e,this.graphicsComponent.alphaComputed)}renderChildren(t,e,i){const n=this.nodeTreeComponent.children;for(let s=0,h=n.length;s<h;s++){const h=n[s];h&&h.isActive&&h.render(t,e,i)}return this}remove(){super.remove(),this.graphicsComponent.remove(),this.spaceComponent.remove(),this.hookComponent.remove(),this.pubsubComponent.remove(),this.nodeTreeComponent.remove(),this.animationComponent.remove(),this.inputComponent.remove(),this.cameraComponent&&this.cameraComponent.remove(),this.graphicsComponent=this.spaceComponent=this.pubsubComponent=this.nodeTreeComponent=this.hookComponent=this.animationComponent=this.inputComponent=this.cameraComponent=null,this._collect()}_collect(){It.collect(this)}}const Lt=[];It.create=function(t){return(Lt.length?Lt.pop():new It).init(t)},It.collect=function(t){Lt.push(t)},It.clean=function(){Lt.length=0};var Ot=It;class Ut extends Ot{constructor(){super()}init(t){return super.init(t),this.cameraComponent=null,this}setCamera(t){return this.cameraComponent=t,this}update(t){return super.update(t,this.cameraComponent),this.cameraComponent&&this.cameraComponent.update(t),this}render(t){super.render(t,this.cameraComponent,this.graphicsComponent.alpha)}remove(){super.remove(),this.cameraComponent&&this.cameraComponent.remove(),this.cameraComponent=null}_collect(){Ut.collect(this)}}const Ft=[];Ut.create=function(t){return(Ft.length?Ft.pop():new Ut).init(t)},Ut.collect=function(t){Ft.push(t)},Ut.clean=function(){Ft.length=0};var Pt=Ut;let zt;var jt=function(){return void 0===zt&&(zt=window.canvas||document.getElementById("canvas")),zt||(zt=document.createElement("canvas"),document.body.appendChild(zt)),zt.setAttribute("tabindex","1"),zt};function Ht(t){return Pt.create(t)}function Wt(t){const e=Ot.create(t.name);return e.spaceComponent.width=t.width,e.spaceComponent.height=t.height,e.spaceComponent.position.update(t.x,t.y),e.graphicsComponent.color=t.color,e}!function(t){const e=function(t,e){return ut.create(jt(),t,e)}(t.width,t.height),i=[];let n;if(t.scenes)for(let e=0;e<t.scenes.length;e++){const s=t.scenes[e],h=Ht(s.name);if(s.hasCamera){const e=window.camera=Mt.create(t.width,t.height);h.setCamera(e)}if(s.isMain&&(n=h),s.children)for(let t=0;t<s.children.length;t++){const e=Wt(s.children[t]);h.nodeTreeComponent.addChild(e)}i.push(h)}n&&e.presentScene(n),e.run()}({width:1024,height:768,scenes:[{name:"intro",isMain:!0,hasCamera:!0,children:[{name:"hero",width:100,height:200,x:400,y:300,color:"#ccddee"}]}]})},function(t,e,i){t.exports=i(0)}]);