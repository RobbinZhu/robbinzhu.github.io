!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";n.r(e);var i={width:1136,height:640,maxWidth:1/0,maxHeight:1/0,state:"AppStateComponent",keyboards:"ADJ ",scenes:[{name:"intro",isMain:!0,children:[{name:"introText",width:200,height:200,x:0,y:0,anchorX:.5,anchorY:.5,relative:{x:.5,y:.5},touchable:!0,touchInput:2,keyInput:"D".charCodeAt(0),textures:[{image:"/img/levelMoon_hand.png"}],event:{name:"navigate",param:"game"},onUpdate:function(){let t=!0;return function(){const e=this.spaceComponent.scale;e.x>1.2?t=!1:e.x<.5&&(t=!0),e.addxy(t?.01:-.01,t?.01:-.01)}}()},{zIndex:-1,name:"bg",width:"1",height:"1",x:0,y:0,anchorX:0,anchorY:0,textures:[{image:"/img/bg_night.jpg"},{image:"/img/bg_night.jpg"}],type:"Button",touchable:!0,touchInput:2,event:{name:"navigate",param:"game"}}]},{name:"game",hasCamera:!0,tile:"http://static-blog.59124.com/my_tile_data.json",hasGridWorld:!0,gridWorldSize:[2e3,1e3,50,20],state:"SceneStateComponent",children:[{name:"hero",width:68,height:100,x:4e3,y:1e3,anchorX:.5,anchorY:.5,color:"red",cameraFollow:!0,state:"HeroStateComponent",textures:[{image:"/img/btn_battle_cat.png"}]},{name:"frog",width:48,height:54,x:4200,y:1e3,anchorX:.5,anchorY:.5,color:"yellow",state:"FrogStateComponent",textures:[{image:"/img/head_focus.png"}]},{name:"star",width:20,height:20,x:4e3,y:1e3,anchorX:.5,anchorY:.5,color:"blue",onUpdate:function(){this.spaceComponent.rotation.add(.02)}},{name:"touchLeft",width:200,height:100,x:0,y:0,anchorX:0,anchorY:1,color:"#ccddee",pressColor:"red",zIndex:999,notUseCamera:!0,touchable:!0,touchInput:1,keyInput:"A".charCodeAt(0),type:"Button",relative:{x:0,y:1}},{name:"touchRight",width:200,height:100,x:200,y:0,anchorX:0,anchorY:1,color:"#ddeecc",pressColor:"red",zIndex:999,notUseCamera:!0,touchable:!0,touchInput:2,keyInput:"D".charCodeAt(0),type:"Button",relative:{x:0,y:1}},{name:"touchJump",width:200,height:100,x:-200,y:0,relative:{x:1,y:1},anchorX:1,anchorY:1,color:"#eeccdd",pressColor:"red",zIndex:999,notUseCamera:!0,touchable:!0,touchInput:4,keyInput:" ".charCodeAt(0),type:"Button"},{name:"touchFire",width:200,height:100,x:0,y:0,relative:{x:1,y:1},anchorX:1,anchorY:1,color:"#ddccee",pressColor:"red",zIndex:999,notUseCamera:!0,touchable:!0,touchInput:8,keyInput:"J".charCodeAt(0),type:"Button"},{name:"back",width:138,height:122,x:-100,y:100,relative:{x:1,y:0},anchorX:1,anchorY:0,touchable:!0,touchInput:16,notUseCamera:!0,textures:[{image:"/img/btn_home_index_quit.png"},{image:"/img/btn_home_index_quit.png"}],type:"Button",event:{name:"navigate",param:"intro"}},{zIndex:-100,name:"bg2",width:"1",height:"1",x:0,y:0,anchorX:0,anchorY:0,notUseCamera:!0,textures:[{image:"/img/bg_moon.jpg"}]}]}]};let o;var s=function(){return void 0===o&&(o=window.canvas||document.getElementById("canvas")),o||(o=document.createElement("canvas"),document.body.appendChild(o)),o.setAttribute("tabindex","1"),o};const r={},a=Array.prototype.slice;function h(t,e,n){return r[e]||(r[e]=[]),r[e].push({host:t,fn:n}),this}function c(t,e,n){if(e){if(!r[e])return this;const i=r[e];if(n){for(let o=i.length-1;o>=0;o--){const s=i[o];s.fn===n&&(null!==t&&s.host!==t||r[e].splice(o,1))}return this}for(let n=i.length-1;n>=0;n--){const o=i[n];null!==t&&o.host!==t||r[e].splice(n,1)}return this}const i=Object.keys(r),o=i.length;for(let e=0;e<o;e++){const n=r[i[e]];for(let i=n.length-1;i>=0;i--){const i=n[e];i&&i.host===t&&n.splice(e,1)}}return this}function u(t){if(!r[t])return;const e=a.call(arguments,1);for(let n=0,i=r[t].length;n<i;n++){const i=r[t][n];i.fn.apply(i.host,e)}return this}var l={on:h,sub:h,off:c,unsub:c,emit:u,pub:u,inspect:function(){return r}};class p{constructor(){}init(t){return this.host=t,this}pub(){return l.pub.apply(null,arguments),this}on(t,e){return l.on(this.host,t,e),this}off(t,e){return l.off(this.host,t,e),this}remove(){this.off(),this.host=null,p.collect(this)}}const d=[];p.create=function(t){return(d.length?d.pop():new p).init(t)},p.collect=function(t){d.push(t)},p.clean=function(){d.length=0};var f=p;class m{constructor(){}init(t){return this.host=t,this.onUpdate=[],this.onRemove=[],this.afterUpdate=[],this}update(){return this}handleOnUpdate(){const t=arguments;for(let e=0,n=this.onUpdate.length;e<n;e++)this.onUpdate[e].apply(this.host,t)}handleAfterUpdate(){const t=arguments;for(let e=0,n=this.afterUpdate.length;e<n;e++)this.afterUpdate[e].apply(this.host,t)}handleOnRemove(){const t=arguments;for(let e=0,n=this.onRemove.length;e<n;e++)this.onRemove[e].apply(this.host,t)}remove(){this.handleOnRemove(),this.host=this.onUpdate=this.afterUpdate=this.onRemove=null,m.collect(this)}}const g=[];m.create=function(t){return(g.length?g.pop():new m).init(t)},m.collect=function(t){g.push(t)},m.clean=function(){g.length=0};var y=m;function v(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,16.67)}}function b(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFram||function(t){window.clearTimeout(t)}}const C=["interactive","loaded","complete"];var x={domReady:new Promise(function(t,e){C.indexOf(document.readyState)>=0?t():function(t,e,n){t.addEventListener(e,n,{passive:!0})}(document,"DOMContentLoaded",t)}),visibilityChange:function(t){if("hidden"in document)document.addEventListener("visibilitychange",function(){t(document.hidden)},!1);else if("webkitHidden"in document)document.addEventListener("webkitvisibilitychange",function(){t(document.webkitHidden)},!1);else if("mozHidden"in document)document.addEventListener("mozvisibilitychange",function(){t(document.mozHidden)},!1);else{if(!("msHidden"in document))return!1;document.addEventListener("msvisibilitychange",function(){t(document.msHidden)},!1)}return!0},requestAnimFrame:v(),cancelAnimFrame:b(),cancelTimeRequest:function(t){return b(t.timeRequest)},setTimeRequest:function(t,e){if(e<=0)return void t();let n=0;const i={timeRequest:v(function o(){++n==e?(t(),o=null,v=null,n=null):i.timeRequest=v(o)})};return i}};const w=x.requestAnimFrame,M=x.cancelAnimFrame;class _{constructor(){}init(){return this.scenes=[],this.resumeScenes=[],this.currentScene=null,this.nextScene=null,this.pubsubComponent=f.create(this),this.hookComponent=y.create(this),this.stateComponent=null,this.requestAnimId=null,this.session=null,this.run=this.runLoop.bind(this),this.isPaused=!1,this}addStateComponent(t){this.stateComponent=t}addSessionSupport(t){this.session=t}pause(){this.isPaused=!0}resume(){this.isPaused=!1}runLoop(){this.isPaused||this.update(this.session),this.render(this.session),this.requestAnimId=w(this.run)}getScene(t){for(let e=0;e<this.scenes.length;e++)if(this.scenes[e].name===t)return this.scenes[e]}_showScene(t){this.scenes.indexOf(t)<0&&this.scenes.push(t),this.currentScene=t,this.nextScene=null}pushScene(t){"function"==typeof t?t(this):this._showScene(t)}update(t){return this.hookComponent.handleOnUpdate(t),this.updateChildren(t,this.cameraComponent),this.hookComponent.handleAfterUpdate(t),this.stateComponent&&this.stateComponent.update(t),this}updateChildren(t){this.currentScene&&this.currentScene.update(t),this.nextScene&&this.nextScene.update(t)}render(t){return t.clear(),this.currentScene&&this.currentScene.render(t),this.nextScene&&this.nextScene.render(t),t.renderFPS(),this}remove(){M(this.requestAnimId),this.scenes.forEach(function(t){t.remove()}),this.resumeScenes.forEach(function(t){t.remove()}),this.hookComponent.remove(),this.pubsubComponent.remove(),this.session&&this.session.remove(),this.requestAnimId=this.hookComponent=this.pubsubComponent=this.currentScene=this.scenes=this.resumeScenes=this.nextScene=this.session=this.run=null,_.collect(this)}}const T=[];_.create=function(){return(T.length?T.pop():new _).init()},_.collect=function(t){T.push(t)},_.clean=function(){T.length=0};var k=_;class I{init(t,e){return this.update(t,e)}clone(){return I.create(this.x,this.y)}update(t,e){return this.x=t,this.y=e,this}set(t){return this.x=t.x,this.y=t.y,this}negate(){return this.x=-this.x,this.y=-this.y,this}distance(t){return Math.sqrt(this.sqrtDistance(t))}sqrtDistance(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}normalize(){const t=1/this.length();return this.x*=t,this.y*=t,this}length(){return Math.sqrt(this.sqrtLength())}sqrtLength(){return this.x*this.x+this.y*this.y}add(t){return this.addxy(t.x,t.y)}addxy(t,e){return this.x+=t,this.y+=e,this}substract(t){return this.substractxy(t.x,t.y)}substractxy(t,e){return this.x-=t,this.y-=e,this}multiply(t){return this.x*=t,this.y*=t,this}devide(t){return this.multiply(1/t)}dot(t){return this.dotxy(t.x,t.y)}dotxy(t,e){return this.x*t+this.y*e}cross(t){return this.crossxy(t.x,t.y)}crossxy(t,e){return this.x*e-this.y*t}rotate(t,e,n){return this.rotateWithSinCos(Math.sin(t),Math.cos(t),e,n)}rotateWithSinCos(t,e,n,i){let o=this.x,s=this.y;return o-=n,s-=i,this.x=e*o+t*s+n,this.y=-t*o+e*s+i,this}angleTo(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}transform(t){const e=this.x,n=this.y;return this.x=t.a*e+t.c*n+t.e,this.y=t.b*e+t.d*n+t.f,this}remove(){I.collect(this)}normal(){return I.create(this.y,-this.x)}major(){return Math.abs(this.x)>Math.abs(this.y)?I.create(this.x>=0?1:-1,0):I.create(0,this.y>=0?1:-1)}lerp(t,e){return e=Math.max(0,Math.min(1,e)),this.addxy((t.x-this.x)*e,(t.y-this.y)*e),this}lerpNoClamp(t,e){return this.addxy((t.x-this.x)*e,(t.y-this.y)*e),this}moveTowards(t,e){const n=t.x-this.x,i=t.y-this.y,o=Math.sqrt(n*n+i*i);if(!(o<=e||0==o)){const t=e/o;this.x+=n*t,this.y+=i*t}return this}}function S(t,e,n){return t<e?t=e:t>n&&(t=n),t}I.SmoothDampVector=function(t,e,n,i,o,s,r){const a=2/(i=Math.max(1e-4,i)),h=a*o,c=1/(1+h+.48*h*h+.235*h*h*h);let u=t.x-e.x,l=t.y-e.y;const p=s.x*i,d=s.y*i;u=S(u,-p,p),l=S(l,-d,d);const f=t.x-u,m=t.y-l,g=(n.x+a*u)*o,y=(n.y+a*l)*o;n.x=(n.x-a*g)*c,n.y=(n.y-a*y)*c;let v=f+(u+g)*c,b=m+(l+y)*c;e.x-t.x>0==r.x>e.x&&(v=e.x,n.x=(v-e.x)/o),e.y-t.y>0==r.y>e.y&&(b=e.y,n.y=(v-e.y)/o),r.x=v,r.y=b};const E=[];I.create=function(t,e){return(E.length?E.pop():new I).init(t,e)},I.collect=function(t){E.push(t)},I.clean=function(){E.length=0};var O=I;class P{constructor(){}update(t,e,n,i,o,s){return this.a=t,this.b=e,this.c=n,this.d=i,this.e=o,this.f=s,this}clone(){return P.create(this.a,this.b,this.c,this.d,this.e,this.f)}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}rotate(t){return this.rotateWithSinCos(Math.sin(t),Math.cos(t))}rotateWithRotation(t){return this.rotateWithSinCos(t.sin,t.cos)}rotateWithSinCos(t,e){const n=this.a,i=this.b,o=this.c,s=this.d;return this.a=n*e+o*t,this.b=i*e+s*t,this.c=-n*t+o*e,this.d=-i*t+s*e,this}skew(t,e){const n=this.a,i=this.b,o=this.c,s=this.d;return t=Math.tan(t),e=Math.tan(e),this.a+=o*t,this.b+=s*t,this.c+=n*e,this.d+=i*e,this}transform(t,e,n,i,o,s){const r=this.a,a=this.b,h=this.c,c=this.d,u=this.e,l=this.f;return this.a=r*t+h*e,this.b=a*t+c*e,this.c=r*n+h*i,this.d=a*n+c*i,this.e=r*o+h*s+u,this.f=a*o+c*s+l,this}transformSomeMatrixTo(t,e){const n=this.a,i=this.b,o=this.c,s=this.d,r=this.e,a=this.f,h=t.a,c=t.b,u=t.c,l=t.d,p=t.e,d=t.f;let f=n*s-i*o;return f=0==f?1:1/f,e.update((s*h-o*c)*f,(i*h-n*c)*-f,(s*u-o*l)*f,(i*u-n*l)*-f,(o*(a-d)+s*(p-r))*f,(n*(a-d)+i*(p-r))*-f)}transformMatrix(t){return this.transform(t.a,t.b,t.c,t.d,t.e,t.f)}transformMatrixTo(t,e){const n=this.a,i=this.b,o=this.c,s=this.d,r=this.e,a=this.f,h=t.a,c=t.b,u=t.c,l=t.d,p=t.e,d=t.f;return e.a=n*h+o*c,e.b=i*h+s*c,e.c=n*u+o*l,e.d=i*u+s*l,e.e=n*p+o*d+r,e.f=i*p+s*d+a,e}transformVector(t){return t.transform(this)}inverse(){return this.inverseTo(this)}inverseTo(t){const e=this.a,n=this.b,i=this.c,o=this.d,s=this.e,r=this.f,a=1/(e*o-n*i);return t.a=o*a,t.b=-n*a,t.c=-i*a,t.d=e*a,t.e=(i*r-o*s)*a,t.f=(n*s-e*r)*a,t}reset(){return this.update(1,0,0,1,0,0)}set(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this}equal(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f}remove(){P.collect(this)}toString(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}}const A=[];P.create=function(t,e,n,i,o,s){return(A.length?A.pop():new P).update(t,e,n,i,o,s)},P.collect=function(t){A.push(t)},P.clean=function(){A.length=0};var j=P;class R{constructor(){}update(t,e,n,i){return this.x=t,this.y=e,this.width=n,this.height=i,this.x2=t+n,this.y2=e+i,this.centerX=t+.5*n,this.centerY=e+.5*n,this}compute(t,e,n,i,o,s,r,a,h,c){const u=a*h,l=r*h,p=-r*c,d=a*c,f=(t-=o)*u+(e-=s)*l,m=t*p+e*d,g=(t+n)*u+e*l,y=(t+n)*p+e*d,v=t*u+(e+i)*l,b=t*p+(e+i)*d,C=(t+n)*u+(e+i)*l,x=(t+n)*p+(e+i)*d,w=Math.min(f,g,v,C),M=Math.max(f,g,v,C),_=Math.min(m,y,b,x),T=Math.max(m,y,b,x);this.x=w+o,this.y=_+s,this.x2=M+o,this.y2=T+s,this.width=M-w,this.height=T-_,this.centerX=.5*(w+M),this.centerY=.5*(_+T)}computeWithMatrix(t,e,n){const i=n.e,o=n.f,s=n.a*t+i,r=n.b*t+o,a=n.a*t+n.c*e+i,h=n.b*t+n.d*e+o,c=n.c*e+i,u=n.d*e+o,l=Math.min(i,s,a,c),p=Math.max(i,s,a,c),d=Math.min(o,r,h,u),f=Math.max(o,r,h,u);this.x=l,this.y=d,this.x2=p,this.y2=f,this.width=p-l,this.height=f-d,this.centerX=.5*(l+p),this.centerY=.5*(d+f)}collide(t){return!(t.x>this.x2||t.y>this.y2||t.x2<this.x||t.y2<this.y)}collideTo(t,e,n,i){return!(t>this.x2||e>this.y2||n<this.x||i<this.y)}contains(t,e){return this.x<=t&&t<=this.x2&&this.y<=e&&e<=this.y2}remove(){R.collect(this)}}const H=[];R.create=function(t,e,n,i){return(H.length?H.pop():new R).update(t,e,n,i)},R.collect=function(t){H.push(t)},R.clean=function(t){H.length=0};var L=R;var N=function(t,e){let n;return function(){const i=this,o=arguments;clearTimeout(n),n=setTimeout(function(){t.apply(i,o)},e)}};class F{constructor(){}init(t){return this.canvas=t,this.width=-1,this.height=-1,this.scaleRatio=-1,this}resize(){const t=window.devicePixelRatio;console.log("resize",t);let e=window.innerWidth,n=window.innerHeight;return this.canvas.style.width=e+"px",this.canvas.style.height=n+"px",e*=t,n*=t,e|=0,n|=0,this.canvas.width=e,this.canvas.height=n,this.width=e,this.height=n,this.scaleRatio=t,this}remove(){this.canvas=null,F.collect(this)}}const W=[];F.create=function(t){return(W.length?W.pop():new F).init(t)},F.collect=function(t){W.push(t)},F.clean=function(){W.length=0};var q=F;class G{constructor(){}init(){return this.mask=0,this}addInput(t){this.mask|=t}removeInput(t){this.mask&=~t}getInput(t){return this.mask&t}getMask(){return this.mask}reset(){this.mask=0}}const z=[];G.create=function(){return(z.length?z.pop():new G).init()},G.collect=function(t){z.push(t)},G.clean=function(){z.length=0};var U=G;class Y{constructor(){}init(t,e,n,i){return this.x=t,this.y=e,this.identifier=i,this.type=n,this}remove(){Y.collect(this)}}const X=[];Y.create=function(t,e,n,i){return(X.length?X.pop():new Y).init(t,e,n,i)},Y.collect=function(t){X.push(t)},Y.clean=function(t){X.length=0};var B=Y;class D{constructor(){}init(t,e){return this.code=t,this.type=e,this}remove(){this.code=null,this.type=null,D.collect(this)}}const J=[];D.create=function(t,e){return(J.length?J.pop():new D).init(t,e)},D.collect=function(t){J.push(t)};var V=D;const K="undefined"!=typeof ejecta,Z={touchstart:"touch",touchmove:"touch",touchend:"touch",touchcancel:"touch",keydown:"key",keypress:"key",keyup:"key"},Q=["touchstart","touchmove","touchend","touchcancel"],$=["keydown","keypress","keyup"],tt={passive:!0},et={touch:function(t,e){const n=e.session,i=e.touchEvents,o=e.touchIdentifiers,s=n.display.scaleRatio,r=n.getTransform();for(let n=0,a=t.changedTouches.length;n<a;n++){const a=t.changedTouches[n],h=a.identifier,c=B.create(r.a*a.clientX*s+r.e,r.d*a.clientY*s+r.f,t.type,h);switch(t.type){case"touchstart":o[h]=c;const n=i.length;let s=0;for(;s<n;){if(null==i[s]){i[s]=c;break}s++}s==n&&i.push(c);break;case"touchmove":if(o[h]){const t=i.indexOf(o[h]);t>-1&&(i[t].remove(),i[t]=c),o[h]=c}break;case"touchend":case"touchcancel":if(o[h]){const t=i.indexOf(o[h]);t>-1&&(i[t].remove(),i[t]=null),e.removeIdentifier(h)}}}let a=!0;for(let t=i.length-1;t>=0;t--)if(i[t]){a=!1;break}a&&(i.length=0)},key:function(t,e){e.session;const n=e.keyEvents,i=t.which||t.keyCode;if(void 0!==n[i])switch(t.type){case"keydown":n[i]||(n[i]=V.create(i,t.type));break;case"keyup":n[i]&&(n[i].remove(),n[i]=null)}}};function nt(t,e,n){for(let i=e.length-1;i>=0;i--)t.addEventListener(e[i],n,tt)}function it(t,e,n){for(let i=e.length-1;i>=0;i--)t.removeEventListener(e[i],n,tt)}class ot{constructor(){}init(t,e){return this.session=e,this.dom=t,this.touchEvents=[],this.keyEvents={},this.touchIdentifiers={},this.filter=this.filter.bind(this),this}listenTouchEvents(){return this.stopListenTouchEvents(),nt(this.dom,Q,this.filter),this}listenKeyEvents(t){const e=this.keyEvents;return t.forEach(function(t){e[t]=null}),this.stopListenKeyEvents(),nt(this.dom,$,this.filter),this}stopListen(){return this.stopListenKeyEvents().stopListenTouchEvents()}stopListenTouchEvents(){return it(this.dom,Q,this.filter),this}stopListenKeyEvents(){return it(this.dom,$,this.filter),this}filter(t){et[Z[t.type]](t,this)}resetTouchEvents(){const t=this.touchEvents;for(let e=0,n=t.length;e<n;e++)t[e]&&t[e].remove();t.length=0}resetKeyEvents(){}removeIdentifier(t){K?delete this.touchIdentifiers[t]:this.touchIdentifiers[t]=null}reset(){}remove(){this.resetTouchEvents(),this.resetKeyEvents(),this.stopListen(),this.filter=this.dom=this.session=this.touchEvents=this.keyEvents=this.touchIdentifiers=null,ot.collect(this)}}const st=[];ot.create=function(t,e){return(st.length?st.pop():new ot).init(t,e)},ot.collect=function(t){st.push(t)},ot.clean=function(){st.length=0};var rt=ot;class at{constructor(){}init(t){return this.display={canvas:t,ctx:t.getContext("2d"),width:0,height:0,baseTransform:j.create(1,0,0,1,0,0),_baseTransformI:j.create(1,0,0,1,0,0),scaleRatio:1},this.pubsubComponent=f.create(this),this.domEventComponent=rt.create(t,this),this.domEventComponent.listenTouchEvents(),this.design={width:0,height:0,maxWidth:0,maxHeight:0,resolution:O.create(0,0)},this.deltaTime=16.66,this.currentTime=0,this.frameNumber=60,this.frameCount=0,this.frameRefreshCount=0,this.canvasResizeComponent=q.create(t),this.commandInputComponent=U.create(),this.resizeEventHandler=N(this.resize.bind(this),100),this.listen(this.resizeEventHandler),this}listen(t){window.removeEventListener("resize",t),window.addEventListener("resize",t)}addCommandInputComponent(t){this.commandInputComponent||(this.commandInputComponent=t||U.create())}getTransform(){return this.display.baseTransform}resize(){const t=this.canvasResizeComponent.resize();this.display.width=t.width,this.display.height=t.height,this.display.scaleRatio=t.scaleRatio;const e=t.width,n=t.height,i=this.design.width,o=this.design.height,s=this.design.maxWidth,r=this.design.maxHeight;let a,h=0,c=0;if(e/n>i/o){a=n/o;const t=Math.ceil(e/a);h=Math.min(s,t),c=o}else{a=e/i;const t=Math.ceil(n/a);c=Math.min(r,t),h=i}this.design.resolution.update(h,c);const u=h*a-e,l=c*a-n;this.display.baseTransform.update(1/a,0,0,1/a,1/a*u*.5,1/a*l*.5),this.display._baseTransformI.update(a,0,0,a,.5*-u,.5*-l),this.pubsubComponent.pub("resolution-change",this.design)}clear(){this.display.ctx.setTransform(1,0,0,1,0,0),this.display.ctx.clearRect(0,0,this.display.width,this.display.height)}setTransform(t,e,n,i,o,s){this.display.ctx.setTransform(t,e,n,i,o,s)}setTransformMatrix(t){this.display.ctx.setTransform(t.a,t.b,t.c,t.d,t.e,t.f)}setAlpha(t){this.display.ctx.globalAlpha=t}computeRenderCost(){const t=Date.now();if(this.currentTime>0){const e=t-this.currentTime;this.frameRefreshCount+=e,++this.frameCount>=60&&(this.frameNumber=(6e4/this.frameRefreshCount).toFixed(1),this.frameCount=0,this.frameRefreshCount=0)}this.currentTime=t}renderFPS(){this.computeRenderCost();const t=this.display.ctx;t.setTransform(1,0,0,1,0,0),t.globalAlpha=1,t.font=32*this.display.scaleRatio+"px Arail",t.fillStyle="red",t.textAlign="start",t.textBaseline="top",t.fillText(this.frameNumber,50,50)}drawImage(t,e,n,i,o,s,r,a,h){return this.display.ctx.drawImage(t,e,n,i,o,s,r,a,h),this}draw(t,e,n,i,o){if(!t)return;const s=this.display.ctx;s.fillStyle=t,s.fillRect(e,n,i,o)}setResolution(t,e,n,i){this.design.width=t,this.design.height=e,this.design.maxWidth=n,this.design.maxHeight=i,this.resize()}remove(){this.pubsubComponent.remove(),window.removeEventListener("resize",this.resizeEventHandler),this.canvasResizeComponent.remove(),this.display.baseTransform.remove(),this.display._baseTransformI.remove(),this.domEventComponent.remove(),this.commandInputComponent&&this.commandInputComponent.remove(),this.pubsubComponent=this.display=this.resizeEventHandler=this.domEventComponent=this.canvasResizeComponent=this.commandInputComponent=this.design=null,at.collect(this)}}const ht=[];at.create=function(t){return(ht.length?ht.pop():new at).init(t)},at.collect=function(t){ht.push(t)},at.clean=function(){ht.length=0};var ct=at;class ut{constructor(){}init(t,e,n,i,o,s,r,a,h){return this.source=t,this.x=e||0,this.y=n||0,this.width=i||t.width,this.height=o||t.height,this.distX=void 0===s?this.x:s,this.distY=void 0===r?this.y:r,this.distWidth=void 0===a?this.width:a,this.distHeight=void 0===h?this.height:h,this.updated=!0,this.style=0,this}updateFrame(){return this}useSheet(){return this}remove(){this.source=null,ut.collect(this)}}ut.style={FULL:0,REPEAT:1};const lt=[];ut.create=function(t,e,n,i,o,s,r,a,h){return(lt.length?lt.pop():new ut).init(t,e,n,i,o,s,r,a,h)},ut.collect=function(){lt.push(this)},ut.clean=function(){lt.length=0};var pt=ut;let dt=[],ft=[];var mt={load:function(t){return dt[t]||(dt[t]=new Promise(function(e,n){const i=new Image;i.src=t,i.onload=function(){e(this),ft[t]=this,this.onload=null}})),dt[t]},get:function(t){return ft[t]},clear:function(){ft=[],dt=[]}},gt={Left:1,Right:2,Jump:4,Fire:8};var yt=class{constructor(){}init(t){return this.host=t,this.velocity=O.create(0,0),this.categoryBits=0,this.maskBits=0,this}canCollideTo(t){return this.maskBits&t.categoryBits&&this.categoryBits&t.maskBits}addCollisionTo(t){this.maskBits|=t.categoryBits}handle(){}integration(){}remove(){this.host=null,this.velocity.remove(),this.host=this.velocity=null}};var vt={Bullet:{categoryBits:1,maskBits:0},Hero:{categoryBits:2,maskBits:0},Monster:{categoryBits:4,maskBits:0}};class bt extends yt{constructor(){super()}init(t,e){return super.init(t),this.life=100,this.categoryBits=vt.Bullet.categoryBits,this.addCollisionTo(vt.Monster),this.velocity.update(e>0?15:-15,0),this}update(t){}handle(t,e,n,i){(this.life--<0||t||n)&&this.host.nodeTreeComponent.removeFromParent()}integration(){this.host.spaceComponent&&this.host.spaceComponent.position.add(this.velocity)}remove(){super.remove(),bt.collect(this)}}const Ct=[];bt.create=function(t,e){return(Ct.length?Ct.pop():new bt).init(t,e)},bt.collect=function(t){Ct.push(t)},bt.clean=function(){Ct.length=0};var xt=bt,wt={touchGround:1,touchTop:2,touchLeft:4,touchRight:8,touchWater:16};class Mt extends yt{constructor(){super()}init(t){return super.init(t),this.categoryBits=vt.Hero.categoryBits,this.addCollisionTo(vt.Monster),this.canJump=!0,this.jumps=[{holdNumber:0,frameNumberThreshold:10,frameNumber:0,velocities:[-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-10,-8,-6,-6,-4,-4,-2,0]},{holdNumber:0,frameNumberThreshold:1e3,frameNumber:0,velocities:[-12,-12,-12,-12,-12,-12,-10,-10,-8,-8,-6,-6,-6,-6,0,0,0,0,0,0]}],this.currentJumpIndex=-1,this.jumpAbility=2,this.canMove=!0,this.velocityMoveX=10,this.velocitySwimX=6,this.velocityJumpX=12,this.velocityMaxY=26,this.stateY=0,this.touchState=0,this.prevInput=0,this.applyGravity=!0,this.gravity=O.create(0,2),this}update(t){const e=t.commandInputComponent,n=e.getInput(gt.Left),i=e.getInput(gt.Right),o=e.getInput(gt.Jump),s=(e.getInput(gt.Fire),this.host);let r=s.spaceComponent.scale.x,a=this.velocity.x,h=this.velocity.y;const c=Math.abs(a),u=(Math.abs(h),a>=0?1:-1),l=this.touchState&wt.touchGround,p=this.touchState&wt.touchTop,d=(this.touchState,wt.touchLeft,this.touchState,wt.touchRight,this.touchState&wt.touchWater),f=this.velocitySwimX,m=this.velocityMoveX;switch(n!=i?(n&&(a=d?-f:-m,r=-1),i&&(a=d?f:m,r=1)):a=c<2?0:u*(c-2),this.stateY){case 0:if(this.canJump&&l&&o&&!(this.prevInput&gt.Jump)){this.currentJumpIndex=0;const t=this.jumps[this.currentJumpIndex];t.holdNumber=0,t.frameNumber=0,h=t.velocities[0],this.stateY=1;break}this.applyGravity&&(h+=this.gravity.y);break;default:if(l||p){this.stateY=0;break}const t=this.jumps[this.currentJumpIndex];if(o?t.holdNumber++:t.holdNumber=0,this.canJump&&this.currentJumpIndex+1<this.jumpAbility&&t.holdNumber>t.frameNumberThreshold){const t=this.jumps[++this.currentJumpIndex];t.frameNumber=0,t.holdNumber=0,h=t.velocities[t.frameNumber],this.stateY++}else t.frameNumber>=t.velocities.length?(t.frameNumber=0,this.stateY=0):h=t.velocities[t.frameNumber],++t.frameNumber}this.velocity.update(a,Math.max(-this.velocityMaxY,Math.min(this.velocityMaxY,h))),s.spaceComponent.scale.x=r,this.prevInput=e.getMask()}handle(t,e,n,i){let o=0;t&&e<0&&(o+=wt.touchLeft),t&&e>0&&(o+=wt.touchRight),n&&i<0&&(o+=wt.touchTop),n&&i>0&&(o+=wt.touchGround),this.touchState=o}integration(){this.host.spaceComponent&&this.host.spaceComponent.position.add(this.velocity)}remove(){super.remove(),this.gravity.remove(),this.gravity=this.jumps=null,this._collect()}_collect(){Mt.collect(this)}}const _t=[];Mt.create=function(t){return(_t.length?_t.pop():new Mt).init(t)},Mt.collect=function(t){_t.push(t)},Mt.clean=function(){_t.length=0};var Tt=Mt;function kt(t,e){return t.nodeTreeComponent.zIndex-e.nodeTreeComponent.zIndex}class It{constructor(){}init(t){return this.host=t,this.children=[],this.parent=null,this.zIndex=0,this}updateZIndex(t){this.zIndex=t}update(){}addChild(t,e){const n=this.children;if(void 0===e)n.push(t);else{for(let t=n.length;t>e;t--)n[t]=n[t-1];n[e]=t}return t.nodeTreeComponent.parent=this,this}addChildSort(t){let e,n=this.children.length-1;for(;n>0&&!((e=this.children[n]).zIndex>=t.zIndex););}sortChildren(){return this.children.sort(kt),this}removeChild(t){return this.removeChildAt(this.children.indexOf(t))}removeChildAt(t){const e=this.children;e[t].remove();for(let n=t,i=e.length-1;n<i;n++)e[n]=e[n+1];return--e.length,this}removeChildren(){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].remove();return t.length=0,this}removeFromParent(){return this.parent&&this.parent.removeChild(this.host),this}remove(){this.removeChildren(),this.host=this.children=this.parent=null}}const St=[];It.create=function(t){return(St.length?St.pop():new It).init(t)},It.collect=function(t){St.push(t)},It.clean=function(){St.length=0};var Et=It;class Ot{constructor(){}init(){return this.texture=null,this.color=null,this.alpha=1,this.alphaComputed=1,this.width=0,this.height=0,this.notUseCamera=!1,this}setColor(t){this.color=t}update(t,e,n){return this}prepareGraphicsInfo(t,e,n,i,o){this.alphaComputed=n*this.alpha,t.setTransformMatrix(e),t.setAlpha(this.alphaComputed),this.width=i,this.height=o}render(t,e){this.texture?this.renderTexture(t,this.texture):this.color&&this.draw(t,this.color)}renderTexture(t,e){t.drawImage(e.source,e.x,e.y,e.width,e.height,0,0,this.width,this.height)}draw(t,e){return t.draw(e,0,0,this.width,this.height),this}updateAlphaRatio(t){this.alphaComputed=this.alpha*t}remove(){this.texture=this.color=null,Ot.collect(this)}}const Pt=[];Ot.create=function(){return(Pt.length?Pt.pop():new Ot).init()},Ot.collect=function(t){Pt.push(t)},Ot.clean=function(){Pt.length=0};var At=Ot;class jt{constructor(){}init(t){return this.target=t,this.actions=[],this}update(t){for(let e=0,n=this.actions.length;e<n;e++){const n=this.actions[e];n&&n.update(t.deltaTime)}return this}remove(){for(let t=0,e=this.actions.length;t<e;t++){const e=this.actions[t];e&&e.remove()}this.actions.length=0,this.target=null,jt.collect(this)}runAction(t){return this.addAction(t),t.run(this.target),this}stopAction(t){return t.stop(),this}pauseAction(t){return t.pause(),this}resumeAction(t){return t.resume(),this}addAction(t){return this.actions.push(t),t.parent=this,this}removeAction(t){for(let e=0,n=this.actions.length;e<n;e++)if(this.actions[e]===t){for(n--;e<n;)this.actions[e]=this.actions[++e];this.actions.length=n;break}return t.remove(),this}}const Rt=[];jt.create=function(t){return(Rt.length?Rt.pop():new jt).init(t)},jt.collect=function(t){Rt.push(t)},jt.clean=function(){Rt.length=0};var Ht=jt;class Lt{constructor(){}init(t){return this.actionManager=Ht.create(t),this}update(t){this.actionManager.update(t)}remove(){this.actionManager.remove(),this.actionManager=null,Lt.collect()}}const Nt=[];Lt.create=function(t){return(Nt.length?Nt.pop():new Lt).init(t)},Lt.collect=function(t){Nt.push(t)},Lt.clean=function(){Nt.length=0};var Ft=Lt;class Wt{constructor(){}clone(){return Wt.create(this.angle)}add(t){return this.update(this.angle+t)}set(t){return this.angle!=t&&this.update(t),this}reset(){return this.angle=0,this.sin=0,this.cos=1,this}update(t){return this.angle=t,this.sin=Math.sin(t),this.cos=Math.cos(t),this}remove(){Wt.collect(this)}}const qt=[];Wt.create=function(t){return(qt.length?qt.pop():new Wt).update(t)},Wt.collect=function(t){qt.push(t)},Wt.clean=function(){qt.length=0};var Gt=Wt;class zt{constructor(){}init(){return this.width=0,this.height=0,this.anchor=O.create(.5,.5),this.rotation=Gt.create(0),this.scale=O.create(1,1),this.position=O.create(0,0),this.frame=L.create(0,0,0,0),this._matrix=j.create(1,0,0,1,0,0),this.touchable=!1,this.touchInput=0,this.keyInput=0,this}update(t,e,n){const i=this.width*this.anchor.x,o=this.height*this.anchor.y,s=this.position.x,r=this.position.y,a=this.rotation.sin,h=this.rotation.cos,c=this.scale.x,u=this.scale.y,l=h*c,p=a*c,d=-a*u,f=h*u,m=this._matrix;return n?m.set(n):m.reset(),m.transform(l,p,d,f,l*-i+d*-o+s,p*-i+f*-o+r),this.frame.computeWithMatrix(this.width,this.height,m),this}handleTouches(t){if(!this.touchable||!t.length)return!1;for(let e=t.length-1;e>=0;e--){const n=t[e];if(n){const t=n.x,e=n.y;if(this.frame.contains(t,e))return!0}}}handleKeyboardEvents(t){return!!this.touchable&&(!!t[this.keyInput]||void 0)}remove(){this.anchor.remove(),this.rotation.remove(),this.scale.remove(),this.position.remove(),this.frame.remove(),this._matrix.remove(),this.anchor=this.rotation=this.scale=this.position=this.frame=this._matrix=null,zt.collect(this)}}const Ut=[];zt.create=function(){return(Ut.length?Ut.pop():new zt).init()},zt.collect=function(t){Ut.push(t)},zt.clean=function(){Ut.length=0};var Yt=zt;class Xt{constructor(){}init(){return this}}const Bt=[];Xt.create=function(t){return(Bt.length?Bt.pop():new Xt).init(t)},Xt.collect=function(t){Bt.push(t)},Xt.clean=function(){Bt.length=0};var Dt=Xt;class Jt{constructor(){}init(t){return this.name=t,this.isPaused=!1,this.isActive=!0,this.nodeTreeComponent=Et.create(this),this.graphicsComponent=At.create(),this.spaceComponent=Yt.create(),this.pubsubComponent=null,this.hookComponent=null,this.animationComponent=null,this.stateComponent=null,this}addStateComponent(t){this.stateComponent||(this.stateComponent=t||Dt.create(this))}addPubsubSupport(){this.pubsubComponent||(this.pubsubComponent=f.create(this))}addHookSupport(){this.hookComponent||(this.hookComponent=y.create(this))}addAnimationSupport(){this.animationComponent||(this.animationComponent=Ft.create(this))}pause(){this.isPaused=!0}resume(){this.isPaused=!1}active(){this.isActive=!0}deactive(){this.isActive=!1}update(t,e,n){return this.isActive?(this.hookComponent&&this.hookComponent.handleOnUpdate(t),this.animationComponent&&this.animationComponent.update(t),this.stateComponent&&this.stateComponent.update(t),this.spaceComponent.update(t,e,n),this.nodeTreeComponent.update(t),this.updateChildren(t,e,this.spaceComponent._matrix),this.hookComponent&&this.hookComponent.handleAfterUpdate(t,e),this):this}updateChildren(t,e,n){this.nodeTreeComponent.children.forEach(function(i){i&&i.update(t,e,n)})}render(t,e,n){if(!this.isActive)return;const i=this.spaceComponent._matrix;if(e&&!this.graphicsComponent.notUseCamera){if(!this.spaceComponent.frame.collide(e.frame))return;e._matrixI.transformMatrixTo(i,i)}else t.display._baseTransformI.transformMatrixTo(i,i);this.graphicsComponent.prepareGraphicsInfo(t,i,n,this.spaceComponent.width,this.spaceComponent.height),this.graphicsComponent.render(t,e),this.renderChildren(t,e,this.graphicsComponent.alphaComputed)}renderChildren(t,e,n){return this.nodeTreeComponent.children.forEach(function(i){i&&i.render(t,e,n)}),this}remove(){this.isActive=!1,this.graphicsComponent.remove(),this.spaceComponent.remove(),this.nodeTreeComponent.remove(),this.pubsubComponent&&this.pubsubComponent.remove(),this.hookComponent&&this.hookComponent.remove(),this.animationComponent&&this.animationComponent.remove(),this.stateComponent&&this.stateComponent.remove(),this.graphicsComponent=this.spaceComponent=this.pubsubComponent=this.nodeTreeComponent=this.hookComponent=this.animationComponent=this.stateComponent=null,this._collect()}_collect(){Jt.collect(this)}}const Vt=[];Jt.create=function(t){return(Vt.length?Vt.pop():new Jt).init(t)},Jt.collect=function(t){Vt.push(t)},Jt.clean=function(){Vt.length=0};var Kt=Jt;const Zt={bullet:{hero:function(){console.log("skip bullet collsion with hero")},frog:function(t,e){e.nodeTreeComponent&&e.nodeTreeComponent.removeFromParent(),t.nodeTreeComponent&&t.nodeTreeComponent.removeFromParent(),console.log("bullet collision to frog")}},frog:{hero:function(t,e){t.nodeTreeComponent&&t.nodeTreeComponent.removeFromParent(),console.log("frog collision to hero")}}};class Qt extends yt{constructor(){super()}init(t){return this.host=t,this.fireTarget=null,this.pubsubComponent=f.create(this),this.fire=function(t,e){let n=0;return function(){const i=Date.now();if(i-n>e){const e=t.apply(this,arguments);return n=i,e}}}(function(){if(this.fireTarget||(this.fireTarget=function(t,e){let n;for(var i=0;i<t.length;i++)if((n=t[i]).name==e)return n}(this.host.nodeTreeComponent.children,"hero")),!this.fireTarget)return;const t=Kt.create("bullet");t.graphicsComponent.color="#FFF",t.spaceComponent.width=30,t.spaceComponent.height=14,t.spaceComponent.position.set(this.fireTarget.spaceComponent.position).addxy(0,20),t.addStateComponent(xt.create(t,this.fireTarget.spaceComponent.scale.x)),this.host.nodeTreeComponent.addChild(t),console.log("add bullet")},300),this.pubsubComponent.on("collision",function(t,e){if(t.name>e.name){const n=e;e=t,t=n}const n=Zt[t.name];n&&n[e.name]&&n[e.name](t,e)}),this}update(t){t.commandInputComponent.getInput(gt.Fire)&&this.fire()}remove(){super.remove(),this.pubsubComponent.remove(),this.fireTarget=this.fire=this.pubsubComponent=null,Qt.collect(this)}}const $t=[];Qt.create=function(t){return($t.length?$t.pop():new Qt).init(t)},Qt.collect=function(t){$t.push(t)},Qt.clean=function(){$t.length=0};var te=Qt;class ee extends yt{constructor(){super()}init(t){return super.init(t),this.categoryBits=vt.Monster.categoryBits,this.addCollisionTo(vt.Hero),this.addCollisionTo(vt.Bullet),this.targetHero=null,this.velocity.y=10,this.stateY=0,this.touchState=0,this.applyGravity=!0,this.gravity=O.create(0,2),this.idleTime=0,this}update(t){if(!this.targetHero){const t=this.host.nodeTreeComponent.parent.children;for(let e=0,n=t.length;e<n;e++)if(t[e]&&"hero"==t[e].name){this.targetHero=t[e];break}}if(!this.targetHero)return;if(this.targetHero&&!this.targetHero.isActive)return void(this.targetHero=null);this.host.spaceComponent.scale.x;let e=this.velocity.x,n=this.velocity.y;Math.abs(e),Math.abs(n);const i=this.touchState&wt.touchGround;this.touchState,wt.touchTop,this.touchState,wt.touchLeft,this.touchState,wt.touchRight,this.touchState,wt.touchWater;switch(this.applyGravity&&(n+=this.gravity.y),this.stateY){case 0:++this.idleTime>=180&&(this.stateY=1,this.idleTime=0),this.velocity.x*=.9;break;case 1:const t=this.targetHero.spaceComponent.frame.x-this.host.spaceComponent.frame.x;-500<=t&&t<=500&&(i&&(n=-10,this.velocity.x=t>0?10:-10),this.host.spaceComponent.scale.x=t>0?1:-1,this.stateY=0)}this.velocity.y=n}handle(t,e,n,i){let o=0;t&&e<0&&(o+=wt.touchLeft),t&&e>0&&(o+=wt.touchRight),n&&i<0&&(o+=wt.touchTop),n&&i>0&&(o+=wt.touchGround),this.touchState=o}integration(){this.host.spaceComponent&&this.host.spaceComponent.position.add(this.velocity)}remove(){super.remove(),this.targetHero=null,ee.collect(this)}}const ne=[];ee.create=function(t){return(ne.length?ne.pop():new ee).init(t)},ee.collect=function(t){ne.push(t)},ee.clean=function(){ne.length=0};var ie=ee;class oe{init(t,e){return this.pubsubComponent=f.create(this),this.frame=L.create(0,0,0,0),this.scale=O.create(1,1),this.position=O.create(0,0),this.width=t,this.height=e,this.halfWidth=t>>1,this.halfHeight=e>>1,this._matrix=j.create(1,0,0,1,0,0),this._matrixI=j.create(1,0,0,1,0,0),this.onlyUseTranslate=!0,this._follow=null,this}update(t){this.updateSize(t.design),this.updateFollowPosition(),this.updateMatrix(t)}updateSize(t){this.width==t.resolution.x&&this.height==t.resolution.y||(this.width=t.resolution.x,this.height=t.resolution.y,this.halfWidth=this.width>>1,this.halfHeight=this.height>>1)}updateMatrix(t){const e=this.halfWidth,n=this.halfHeight;if(this.onlyUseTranslate){const t=this.position.x-e,i=this.position.y-n;this._matrix.update(1,0,0,1,t,i),this._matrixI.update(1,0,0,1,-t,-i),this.frame.update(t,i,this.width,this.height)}else{const t=this.scale.x,i=this.scale.y,o=this.position.x-t*e,s=this.position.y-t*n;this._matrix.update(t,0,0,i,o,s),this._matrixI.update(1!=t?1/t:1,0,0,1!=i?1/i:1,-o,-s),this.frame.update(o,s,this.width*t,this.height*i)}return t.display._baseTransformI.transformMatrixTo(this._matrixI,this._matrixI),this}updateFollowPosition(){if(!this._follow)return;const t=this._follow.spaceComponent.position,e=this.position.x-t.x,n=this.position.y-t.y;this.position.substractxy(Math.ceil(.1*e),Math.ceil(.1*n)),this.position.x<this.halfWidth&&(this.position.x=this.halfWidth)}follow(t){this._follow=t}remove(){this.pubsubComponent.remove(),this.scale.remove(),this.position.remove(),this._matrix.remove(),this._matrixI.remove(),this.frame.remove(),this.pubsubComponent=this.scale=this.position=this._matrix=this._matrixI=this.frame=this._follow=null,this._collect()}_collect(){oe.collect(this)}}const se=[];oe.create=function(t,e){return(se.length?se.pop():new oe).init(t,e)},oe.collect=function(t){se.push(t)},oe.clean=function(){se.length=0};var re=oe;class ae{constructor(){}init(t,e){return this.host=t,this.gridWidth=e.gridWidth,this.gridHeight=e.gridHeight,this.gridWidthI=1/e.gridWidth,this.gridHeightI=1/e.gridHeight,this.gridColumnCount=e.gridColumnCount,this.gridRowCount=e.gridRowCount,this.bufferSizeOfGrid=0,this.validXMin=0,this.validXMax=0,this.validYMin=0,this.validYMax=0,this.validXMinIndex=0,this.validXMaxIndex=0,this.validYMinIndex=0,this.validYMaxIndex=0,this.childrenInView=[],this}update(t,e){if(e){const t=this.childrenInView;t.length=0;let n=Math.min(Math.max(0,-this.bufferSizeOfGrid+e.frame.x*this.gridWidthI|0),this.gridColumnCount),i=Math.min(Math.max(0,this.bufferSizeOfGrid+Math.ceil(e.frame.x2*this.gridWidthI)),this.gridColumnCount),o=Math.min(Math.max(0,-this.bufferSizeOfGrid+e.frame.y*this.gridHeightI|0),this.gridRowCount),s=Math.min(Math.max(0,this.bufferSizeOfGrid+Math.ceil(e.frame.y2*this.gridHeightI)),this.gridRowCount);this.validXMinIndex=n,this.validXMaxIndex=i,this.validYMinIndex=o,this.validYMaxIndex=s,n*=this.gridWidth,i*=this.gridWidth,o*=this.gridHeight,s*=this.gridHeight,this.validXMin=n,this.validXMax=i,this.validYMin=o,this.validYMax=s,this.host.nodeTreeComponent.children.forEach(function(e){(e.graphicsComponent&&e.graphicsComponent.notUseCamera||e.spaceComponent&&e.spaceComponent.frame.collideTo(n,o,i,s))&&t.push(e)})}}remove(){this.host=this.childrenInView=null,this._collect()}_collect(){ae.collect(this)}}const he=[];ae.create=function(...t){return(he.length?he.pop():new ae).init(...t)},ae.collect=function(t){he.push(t)},ae.clean=function(){he.length=0};var ce=ae;class ue extends Kt{constructor(){super()}init(t){return super.init(t),this.cameraComponent=null,this.tileComponent=null,this.tileGridComponent=null,this}setTile(t){this.tileComponent=t,this.nodeTreeComponent.addChild(t),this.tileGridComponent=ce.create(this,t)}addCameraSupport(t,e){this.cameraComponent=re.create(t,e)}handleInput(t){if(this.isPaused)return;t.commandInputComponent.reset();const e=t.domEventComponent.touchEvents,n=t.domEventComponent.keyEvents;this.nodeTreeComponent.children.forEach(function(i){if(i.spaceComponent){(i.spaceComponent.handleKeyboardEvents(n)||i.spaceComponent.handleTouches(e))&&t.commandInputComponent.addInput(i.spaceComponent.touchInput)}})}update(t){const e=this.cameraComponent;return this.handleInput(t,e),super.update(t,e,this.spaceComponent._matrix),this.tileComponent&&this.tileComponent.updateCollision(e,this),this.tileGridComponent&&this.tileGridComponent.update(t,e),e&&e.update(t),this}updateChildren(t,e,n){this.nodeTreeComponent.children.forEach(function(i){i&&i.update(t,e,n)})}render(t){this.renderChildren(t,this.cameraComponent,this.graphicsComponent.alpha)}remove(){super.remove(),this.cameraComponent&&this.cameraComponent.remove(),this.tileComponent&&this.tileComponent.remove(),this.tileGridComponent&&this.tileGridComponent.remove(),this.childrenInView=this.cameraComponent=this.tileComponent=this.tileGridComponent=null}_collect(){ue.collect(this)}}const le=[];ue.create=function(t){return(le.length?le.pop():new ue).init(t)},ue.collect=function(t){le.push(t)},ue.clean=function(){le.length=0};var pe=ue;class de{constructor(){}init(t,e,n,i){return this.name="FadeTo",this.parent=null,this.target=null,this.from=0,this.to=t,this.delta=0,this.tick=0,this.duration=e,this.iDuration=0!=e?1/e:0,this.ease=n,this.callback=i,this.fn=null,this.isFinished=!1,this}initWithFn(t,e,n,i){return this.init(null,e,n,i),this.fn=t,this}run(t){return this.target=t,this.fn&&this.fn(t),this.from=t.graphicsComponent.alpha,this.delta=this.to-this.from,this}updateFrame(t){return this.target.graphicsComponent.alpha=this.delta*t+this.from,this}update(t){return this.tick+=t,this.tick>=this.duration?(this.updateFrame(1),this.isFinished=!0,this.callback&&this.callback(this.target),this.parent.removeAction(this)):this.updateFrame(this.tick*this.iDuration),this}restore(){return this.tick=0,this.isFinished=!1,this}remove(){this.parent=this.target=this.callback=this.fn=null,this._collect()}_collect(){de.collect(this)}}const fe=[];de.create=function(t,e,n,i){return(fe.length?fe.pop():new de).init(t,e,n,i)},de.createWithFn=function(t,e,n,i){return(fe.length?fe.pop():new de).initWithFn(t,e,n,i)},de.collect=function(t){fe.push(t)},de.clean=function(){fe.length=0};var me=de;class ge extends Kt{constructor(){super()}init(t,e){return super.init(t),this.pressColor=e.pressColor,this.normalColor=e.color,this.textures=e.textures,e.event&&this.addPubsubSupport(),this.event=e.event,this.addHookSupport(),this.pressedTime=-1,this.hookComponent.onUpdate.push(function(t){let e=0;t.commandInputComponent.getInput(this.spaceComponent.touchInput)?(this.graphicsComponent.color=this.pressColor,e=1,this.event&&this.pressedTime<0&&(this.pressedTime=Date.now())):(this.event&&this.pressedTime>0&&(Date.now()-this.pressedTime>50&&this.pubsubComponent.pub(this.event.name,this.event.param),this.pressedTime=-1),e=0,this.graphicsComponent.color=this.normalColor),this.textures&&(this.graphicsComponent.texture=this.textures[e]&&this.textures[e].texture)}),this}}const ye=[];ge.create=function(t,e){return(ye.length?ye.pop():new ge).init(t,e)},ge.collect=function(t){ye.push(t)},ge.clean=function(){ye.length=0};var ve=ge;class be{constructor(){this.reset()}reset(){return this.x=0,this.y=0,this.canContinue=!1,this.canBreak=!1,this}remove(){}}class Ce{constructor(){}init(t,e,n){return this.name="tiledmap",this.nodeTreeComponent=Et.create(this),this.isPaused=!1,this.isActive=!0,this.json=t,this.layers=this.initLayers(t,e,n),this.image=null,this.imageUrl=t.tilesets&&t.tilesets[0]&&t.tilesets[0].image,this.collideLayer=this.getCollideLayer(),this.width=t.tilewidth*t.width,this.height=t.tileheight*t.height,this.gridWidth=this.collideLayer.gridWidth,this.gridHeight=this.collideLayer.gridHeight,this.gridWidthI=1/this.collideLayer.gridWidth,this.gridHeightI=1/this.collideLayer.gridHeight,this.gridColumnCount=this.collideLayer.gridColumnCount,this.gridRowCount=this.collideLayer.gridRowCount,this.cellXInGrid=e,this.cellYInGrid=n,this.init=!1,this.pubsubComponent=f.create(this),this.collisionResolver=new be,this}getCollideLayer(){let t;const e=this.layers;for(let n=0,i=e.length;n<i;n++){const i=e[n];"main"==i.name&&(t=i);break}return t}initLayers(t,e,n){const i=t.layers,o=t.tileheight,s=t.tilewidth,r=[],a=t.tilesets[0],h=a.imagewidth/a.tilewidth|0,c=1/h,u=(a.imageheight,a.tileheight,a.image,a.firstgid),l=a.tileoffset;for(let t=0,p=i.length;t<p;t++){const p=i[t],d=p.width,f=p.height;if(p.visible)switch(p.type){case"tilelayer":const t=[],i={tilewidth:s,tileheight:o,gridRowCount:Math.ceil(f/n),gridColumnCount:Math.ceil(d/e),gridWidth:e*s,gridHeight:n*o,gridWidthI:1/(e*s),gridHeightI:1/(n*o),name:p.name,width:p.width,height:p.height,opacity:p.opacity,type:p.type,visible:p.visible,x:p.x,y:p.y,items:t};r.push(i);const m=p.data;let g=0,y=0;for(let e=0,n=m.length;e<n;e++){let n=m[e];n>0?(n-=u,t.push([n,n%h*a.tilewidth-l.x,(n*c|0)*a.tileheight+l.y,s,o,g*s,y*o])):t.push(null),++g==d&&(g=0,y++)}break;case"objectgroup":for(let t=0,e=p.objects.length;t<e;t++){p.objects[t].gid}console.log("objectgroup not support")}}return r}render(t,e,n){if(!this.image)return void(this.init||(this.init=!0,mt.load(this.imageUrl).then(function(t){this.image=t}.bind(this))));const i=this.layers,o=e.frame.x,s=e.frame.y,r=e.frame.x2,a=e.frame.y2,h=Math.min(Math.max(0,o*this.gridWidthI|0),this.gridColumnCount)*this.cellXInGrid,c=Math.min(Math.max(0,Math.ceil(r*this.gridWidthI)),this.gridColumnCount)*this.cellXInGrid,u=Math.min(Math.max(0,s*this.gridHeightI|0),this.gridRowCount)*this.cellYInGrid,l=Math.min(Math.max(0,Math.ceil(a*this.gridHeightI)),this.gridRowCount)*this.cellYInGrid;t.setAlpha(n),t.setTransformMatrix(e._matrixI);for(let e=0,n=i.length;e<n;e++)this.renderLayer(t,i[e],this.image,h,c,u,l)}renderLayer(t,e,n,i,o,s,r){const a=e.items;for(var h=s;h<r;h++){const s=h*e.width;for(var c=i;c<o;c++){const e=a[s+c];e&&t.drawImage(n,e[1],e[2],e[3],e[4],e[5]-1,e[6]-1,e[3]+2,e[4]+2)}}}updateCollision(t,e){const n=Math.min(Math.max(0,t.frame.x*this.gridWidthI|0),this.gridColumnCount)*this.cellXInGrid,i=Math.min(Math.max(0,Math.ceil(t.frame.x2*this.gridWidthI)),this.gridColumnCount)*this.cellXInGrid,o=Math.min(Math.max(0,t.frame.y*this.gridHeightI|0),this.gridRowCount)*this.cellYInGrid,s=Math.min(Math.max(0,Math.ceil(t.frame.y2*this.gridHeightI)),this.gridRowCount)*this.cellYInGrid,r=e.nodeTreeComponent.children,a=this.collideLayer;this.collideNodes(r);for(let t=0;t<r.length;t++)this.collideNode(a,r[t],n,i,o,s);for(let t=0;t<r.length;t++){const e=r[t];e.stateComponent&&e.stateComponent.integration()}}update(){}collideNodes(t){const e=t.length;let n,i;for(var o=0;o<e;o++)if((n=t[o])&&n.stateComponent)for(var s=o+1;s<e;s++)(i=t[s])&&i.stateComponent&&this.collideAB(n,i)}collideAB(t,e){t.stateComponent.canCollideTo(e.stateComponent)&&t.spaceComponent.frame.collide(e.spaceComponent.frame)&&this.pubsubComponent.pub("collision",t,e)}collideNode(t,e,n,i,o,s){if(!e.graphicsComponent||e.graphicsComponent.notUseCamera||!e.stateComponent)return;const r=t.items,a=(t.width,t.height,t.tilewidth,t.tileheight,e.stateComponent.velocity),h=a.x,c=a.y,u=e.spaceComponent.frame;this.collisionResolver.reset(),this.collideX(u,h,r,t),this.collideY(u,h,c,r,t),a.add(this.collisionResolver),e.stateComponent.handle(this.collisionResolver.x,h,this.collisionResolver.y,c)}collideX(t,e,n,i){const o=i.width,s=i.height,r=i.tilewidth,a=i.tileheight,h=t.x+e,c=t.x2+e,u=t.y,l=t.y2,p=Math.min(Math.max(0,h/r|0),o),d=Math.min(Math.max(0,Math.ceil(c/r)),o),f=Math.min(Math.max(0,u/a|0),s),m=Math.min(Math.max(0,Math.ceil(l/a)),s),g=Math.abs(e),y=e>=0?1:-1,v=this.collisionResolver;let b,C,x=f;t:for(;x<=m;){for(C=x*o,b=p;b<=d;){if(v.canBreak)break t;v.canContinue||(this.resolveGridX(n[C+b],g,y,h,c,u,l),b++)}x++}}collideY(t,e,n,i,o){const s=o.width,r=o.height,a=o.tilewidth,h=o.tileheight;e+=this.collisionResolver.x;const c=t.x+e,u=t.x2+e,l=t.y+n,p=t.y2+n,d=Math.min(Math.max(0,c/a|0),s),f=Math.min(Math.max(0,Math.ceil(u/a)),s),m=Math.min(Math.max(0,l/h|0),r),g=Math.min(Math.max(0,Math.ceil(p/h)),r),y=Math.abs(n),v=n>=0?1:-1;let b,C,x=m;const w=this.collisionResolver;t:for(;x<=g;){for(C=x*s,b=d;b<=f;){if(w.canBreak)break t;w.canContinue||(this.resolveGridY(i[C+b],y,v,c,u,l,p),b++)}x++}}skipGridX(t){return!1}skipGridY(t){return!1}resolveGridX(t,e,n,i,o,s,r){const a=this.collisionResolver;if(t){const h=t[0];if(!this.skipGridX(h)){const h=t[5],c=t[6],u=t[3],l=t[4];if(!(h>=o||c>=r||h+u<=i||c+l<=s)){const t=n>0?Math.max(a.x,o-h):Math.max(h+u-i,a.x);t<=e&&(a.x=n>0?-t:t)}}}}resolveGridY(t,e,n,i,o,s,r){if(!t)return;const a=t[0];this.skipGridY(a)||this.handleGridY(a,t,n,e,i,o,s,r)}handleGridY(t,e,n,i,o,s,r,a){const h=this.collisionResolver,c=e[5],u=e[6],l=e[3],p=e[4];if(!(c>=s||u>=a||c+l<=o||u+p<=r)){const t=n>0?Math.max(h.y,a-u):Math.max(u+p-r,h.y);t<=i&&(h.y=n>0?-t:t)}}remove(){this.pubsubComponent.remove(),this.collisionResolver.remove(),this.pubsubComponent=this.collisionResolver=this.json=this.layers=this.image=this.imageUrl=this.collideLayer=null,Ce.collect(this)}}const xe=[];Ce.create=function(t,e,n){return(xe.length?xe.pop():new Ce).init(t,e,n)},Ce.collect=function(t){xe.push(t)},Ce.clean=function(){xe.length=0};var we=Ce;var Me={get:function(t,e){const n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&e(JSON.parse(this.responseText))},n.open("GET",t,!0),n.setRequestHeader("Content-type","application/json; charset=UTF-8"),n.send()},post:function(t,e,n){const i=new XMLHttpRequest;i.onreadystatechange=function(){4==this.readyState&&200==this.status&&n(JSON.parse(this.responseText))},i.open("POST",t,!0),i.setRequestHeader("Content-type","application/json; charset=UTF-8"),i.send(JSON.stringify(e))}};const _e={51:0,52:1,61:2,62:3,53:4,54:5,55:6,56:7,63:8,64:9,65:10,66:11,94:1,97:0},Te=[O.create(0,64),O.create(0,0),O.create(0,0),O.create(0,64),O.create(0,64),O.create(0,32),O.create(0,0),O.create(0,32),O.create(0,0),O.create(0,32),O.create(0,64),O.create(0,32)],ke=[O.create(-1/Math.sqrt(2),-1/Math.sqrt(2)),O.create(1/Math.sqrt(2),-1/Math.sqrt(2)),O.create(-1/Math.sqrt(2),1/Math.sqrt(2)),O.create(1/Math.sqrt(2),1/Math.sqrt(2)),O.create(-.5/Math.sqrt(1.25),-1/Math.sqrt(1.25)),O.create(-.5/Math.sqrt(1.25),-1/Math.sqrt(1.25)),O.create(.5/Math.sqrt(1.25),-1/Math.sqrt(1.25)),O.create(.5/Math.sqrt(1.25),-1/Math.sqrt(1.25)),O.create(-.5/Math.sqrt(1.25),1/Math.sqrt(1.25)),O.create(-.5/Math.sqrt(1.25),1/Math.sqrt(1.25)),O.create(.5/Math.sqrt(1.25),1/Math.sqrt(1.25)),O.create(.5/Math.sqrt(1.25),1/Math.sqrt(1.25))];function Ie(t){return 92==t}function Se(t){return void 0!==_e[t]}class Ee extends we{constructor(){super()}skipGridX(t){return Ie(t)||Se(t)}handleGridY(t,e,n,i,o,s,r,a){const h=this.collisionResolver,c=e[5],u=e[6],l=e[3],p=e[4];if(!(c>=s||u>=a||c+l<=o||u+p<=r))if(Ie(t)){const t=n*i;t>0&&a-t<=u&&a>=u&&(h.y=-a+u,h.canBreak=!0)}else if(Se(t)){const e=_e[t],n=function(t,e,n,i,o,s,r){switch(t){case 0:case 5:if(e<=s+64&&s+64<=i&&n<=r&&r<=o)return-o+r;break;case 1:case 6:if(e<=s&&s<=i&&n<=r&&r<=o)return-o+r;break;case 2:case 9:if(e<=s+64&&s+64<=i&&n<=r+64&&r+64<=o)return r+64-n;break;case 3:case 10:if(e<=s&&s<=i&&n<=r+64&&r+64<=o)return r+64-n;break;case 4:if(e<=s+64&&s+64<=i&&n<=r+32&&r+32<=o)return-o+r+32;break;case 7:if(e<=s&&s<=i&&n<=r+32&&r+32<=o)return-o+r+32;break;case 8:if(e<=s+64&&s+64<=i&&n<=r+32&&r+32<=o)return r+32-n;break;case 11:if(e<=s&&s<=i&&n<=r+32&&r+32<=o)return r+32-n}}(e,o,r,s,a,c,u);if(void 0!==n)return void(h.y=n);const i=ke[e],l=(s-o)*i.x,p=(a-r)*i.y,d=o*i.x+r*i.y,f=d+l,m=f+p,g=d+p,y=Math.min(d,f,m,g),v=Math.max(d,f,m,g),b=O.create(c,u).add(Te[e]),C=b.dot(i);b.remove(),y<=C&&C<=v&&(h.y=(i.y>0?1:-1)*Math.round(C-y),h.canBreak=!0)}else super.handleGridY(t,e,n,i,o,s,r,a)}}const Oe=[];Ee.init=function(t,e){Me.get(t,function(t){e(Ee.create(t,6,6))})},Ee.create=function(t,e,n){return(Oe.length?Oe.pop():new Ee).init(t,e,n)},Ee.collect=function(t){Oe.push(t)},Ee.clean=function(){Oe.length=0};var Pe=Ee;const Ae={Node:Kt,Scene:pe,Button:ve},je={HeroStateComponent:Tt,SceneStateComponent:te,FrogStateComponent:ie};function Re(t){const e=function(t){return Ae[t]||Kt}(t.type);if(!e)return;const n=e.create(t.name,t);if("string"==typeof t.width){n.addHookSupport();const e=parseFloat(t.width),i=parseFloat(t.height);n.hookComponent.onUpdate.push(function(t){this.spaceComponent.width=e*t.design.resolution.x,this.spaceComponent.height=i*t.design.resolution.y})}else n.spaceComponent.width=t.width,n.spaceComponent.height=t.height;if(t.hasOwnProperty("zIndex")&&(n.nodeTreeComponent.zIndex=t.zIndex),t.hasOwnProperty("anchorX")&&n.spaceComponent.anchor.update(t.anchorX,t.anchorY),n.spaceComponent.position.update(t.x,t.y),t.hasOwnProperty("notUseCamera")&&(n.graphicsComponent.notUseCamera=t.notUseCamera),t.textures&&t.textures.forEach(function(t,e,i){mt.load(t.image).then(function(e){const o=t.size?t.size.slice(0):[];o.unshift(e),t.texture=pt.create.apply(pt,o),1==i.length&&(n.graphicsComponent.texture=t.texture)})}),t.onUpdate&&(n.addHookSupport(),n.hookComponent.onUpdate.push(t.onUpdate)),t.hasOwnProperty("relative")){n.addHookSupport();const e=t.relative.x,i=t.relative.y,o=t.x,s=t.y;n.hookComponent.onUpdate.push(function(t){this.spaceComponent.position.update(o+e*t.design.resolution.x,s+i*t.design.resolution.y)})}return n.graphicsComponent.color=t.color,n}function He(t,e,n){if(e){for(let i=0;i<e.length;i++){const o=e[i],s=Re(o);o.touchable&&(s.spaceComponent.touchable=!0),o.touchInput&&(s.spaceComponent.touchInput=o.touchInput),o.keyInput&&(s.spaceComponent.keyInput=o.keyInput),o.state&&s.addStateComponent(je[o.state].create(s)),o.cameraFollow&&(n.cameraFollow=s),s&&t.nodeTreeComponent.addChild(s),He(s,o.children)}t.nodeTreeComponent.sortChildren()}}function Le(t,e,n){const i=pe.create(t.name),o={cameraFollow:null};return t.hasCamera&&i.addCameraSupport(e,n),t.tile?Pe.init(t.tile,function(e){i.setTile(e),t.state&&i.addStateComponent(je[t.state].create(i)),He(i,t.children,o),o.cameraFollow&&(i.cameraComponent&&i.cameraComponent.position.set(o.cameraFollow.spaceComponent.position),i.cameraComponent.follow(o.cameraFollow))}):(t.state&&i.addStateComponent(je[t.state].create(i)),He(i,t.children,o),o.cameraFollow&&(i.cameraComponent&&i.cameraComponent.position.set(o.cameraFollow.spaceComponent.position),i.cameraComponent.follow(o.cameraFollow))),i}class Ne{constructor(){}init(t,e){if(this.host=t,this.pubsubComponent=f.create(this),this.pubsubComponent.on("navigate",function(n){let i=t.getScene(n);if(!i)for(var o=0;o<e.scenes.length;o++)if(e.scenes[o].name===n){i=Le(e.scenes[o],e.width,e.height);break}i&&function(t,e){t.pushScene(function(t){const n=t.currentScene;n.pause(),n.addAnimationSupport(),e.graphicsComponent.alpha=0,e.addAnimationSupport(),Promise.resolve().then(function(){return new Promise(function(t,e){n.animationComponent.actionManager.runAction(me.create(0,1e3,null,t))})}).then(function(){return new Promise(function(n,i){t.nextScene=e,e.animationComponent.actionManager.runAction(me.create(1,1e3,null,n))})}).then(function(){t.pushScene(e),e.resume()})})}(this.host,i)}),e.scenes)for(let t=0;t<e.scenes.length;t++){const n=e.scenes[t];n.isMain&&this.host.pushScene(Le(n,e.width,e.height))}return this}transitionTo(t){this.host.getScene(t.name)}update(t){}remove(){this.pubsubComponent.remove(),this.host=null,this.pubsubComponent=null,Ne.collect(this)}}const Fe=[];Ne.create=function(t,e){return(Fe.length?Fe.pop():new Ne).init(t,e)},Ne.collect=function(t){Fe.push(t)},Ne.clean=function(){Fe.length=0};var We=Ne;!function(t){const e=k.create();e.addSessionSupport(function(t){const e=ct.create(s());return e.setResolution(t.width,t.height,t.maxWidth,t.maxHeight),t.keyboards&&e.domEventComponent.listenKeyEvents(t.keyboards.split("").map(function(t){return t.charCodeAt(0)})),window.session=e,e}(t)),t.state&&e.addStateComponent(We.create(e,t)),e.run()}(i)},function(t,e){!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.m=t,n.c=e,n.p="",n(0)}([function(t,e,n){"use strict";var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1));var o=GameGlobal;GameGlobal.__isAdapterInjected||(GameGlobal.__isAdapterInjected=!0,function(){i.addEventListener=i.canvas.addEventListener=function(t,e){i.document.addEventListener(t,e)},i.removeEventListener=i.canvas.removeEventListener=function(t,e){i.document.removeEventListener(t,e)};var t=wx.getSystemInfoSync().platform;if("undefined"==typeof __devtoolssubcontext&&"devtools"===t){for(var e in i){var n=Object.getOwnPropertyDescriptor(o,e);n&&!0!==n.configurable||Object.defineProperty(window,e,{value:i[e]})}for(var s in i.document){var r=Object.getOwnPropertyDescriptor(o.document,s);r&&!0!==r.configurable||Object.defineProperty(o.document,s,{value:i.document[s]})}window.parent=window}else{for(var a in i)o[a]=i[a];o.window=i,window=o,window.top=window.parent=window}}())},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cancelAnimationFrame=e.requestAnimationFrame=e.clearInterval=e.clearTimeout=e.setInterval=e.setTimeout=e.canvas=e.location=e.localStorage=e.HTMLElement=e.FileReader=e.Audio=e.Image=e.WebSocket=e.XMLHttpRequest=e.navigator=e.document=void 0;var i=n(2);Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}})});var o=n(3);Object.keys(o).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})});var s=g(n(9)),r=g(n(10)),a=g(n(17)),h=g(n(18)),c=g(n(19)),u=g(n(11)),l=g(n(12)),p=g(n(20)),d=g(n(4)),f=g(n(21)),m=g(n(22));function g(t){return t&&t.__esModule?t:{default:t}}e.document=r.default,e.navigator=a.default,e.XMLHttpRequest=h.default,e.WebSocket=c.default,e.Image=u.default,e.Audio=l.default,e.FileReader=p.default,e.HTMLElement=d.default,e.localStorage=f.default,e.location=m.default;var y=new s.default;e.canvas=y,e.setTimeout=setTimeout,e.setInterval=setInterval,e.clearTimeout=clearTimeout,e.clearInterval=clearInterval,e.requestAnimationFrame=requestAnimationFrame,e.cancelAnimationFrame=cancelAnimationFrame},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=wx.getSystemInfoSync(),i=n.screenWidth,o=n.screenHeight,s=n.devicePixelRatio,r=e.innerWidth=i,a=e.innerHeight=o;e.devicePixelRatio=s;e.screen={availWidth:r,availHeight:a},e.performance={now:function(){return Date.now()/1e3}},e.ontouchstart=null,e.ontouchmove=null,e.ontouchend=null},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLCanvasElement=e.HTMLImageElement=void 0;var i=function(t){return t&&t.__esModule?t:{default:t}}(n(4));function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.HTMLImageElement=function(t){function e(){return o(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"img"))}return r(e,i.default),e}(),e.HTMLCanvasElement=function(t){function e(){return o(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"canvas"))}return r(e,i.default),e}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(n(5)),s=n(8),r=n(2);var a=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.className="",n.childern=[],n.style={width:r.innerWidth+"px",height:r.innerHeight+"px"},n.insertBefore=s.noop,n.innerHTML="",n.tagName=t.toUpperCase(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"getBoundingClientRect",value:function(){return{top:0,left:0,width:r.innerWidth,height:r.innerHeight}}},{key:"focus",value:function(){}},{key:"clientWidth",get:function(){var t=parseInt(this.style.fontSize,10)*this.innerHTML.length;return Number.isNaN(t)?0:t}},{key:"clientHeight",get:function(){var t=parseInt(this.style.fontSize,10);return Number.isNaN(t)?0:t}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return t&&t.__esModule?t:{default:t}}(n(6));var o=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.className="",t.children=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.default),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(n(7));var s=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.childNodes=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"appendChild",value:function(t){if(!(t instanceof e))throw new TypeError("Failed to executed 'appendChild' on 'Node': parameter 1 is not of type 'Node'.");this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex(function(e){return e===t});return e>-1?this.childNodes.splice(e,1):null}}]),e}();e.default=s},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var i=new WeakMap,o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i.set(this,{})}return n(t,[{key:"addEventListener",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=i.get(this);o||(o={},i.set(this,o)),o[t]||(o[t]=[]),o[t].push(e),n.capture&&console.warn("EventTarget.addEventListener: options.capture is not implemented."),n.once&&console.warn("EventTarget.addEventListener: options.once is not implemented."),n.passive&&console.warn("EventTarget.addEventListener: options.passive is not implemented.")}},{key:"removeEventListener",value:function(t,e){var n=i.get(this)[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}},{key:"dispatchEvent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=i.get(this)[t.type];if(e)for(var n=0;n<e.length;n++)e[n](t)}}]),t}();e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.noop=function(){}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=wx.createCanvas();t.type="canvas",t.__proto__.__proto__=new i.default("canvas");t.getContext;return t.getBoundingClientRect=function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}},t};n(3);var i=o(n(4));o(n(10));function o(t){return t&&t.__esModule?t:{default:t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=h(n(4)),s=h(n(11)),r=h(n(12)),a=h(n(9));function h(t){return t&&t.__esModule?t:{default:t}}n(15);var c={},u={readyState:"complete",visibilityState:"visible",documentElement:i,hidden:!1,style:{},location:i.location,ontouchstart:null,ontouchmove:null,ontouchend:null,head:new o.default("head"),body:new o.default("body"),createElement:function(t){return"canvas"===t?new a.default:"audio"===t?new r.default:"img"===t?new s.default:new o.default(t)},getElementById:function(t){return t===i.canvas.id?i.canvas:null},getElementsByTagName:function(t){return"head"===t?[u.head]:"body"===t?[u.body]:"canvas"===t?[i.canvas]:[]},querySelector:function(t){return"head"===t?u.head:"body"===t?u.body:"canvas"===t?i.canvas:t==="#"+i.canvas.id?i.canvas:null},querySelectorAll:function(t){return"head"===t?[u.head]:"body"===t?[u.body]:"canvas"===t?[i.canvas]:[]},addEventListener:function(t,e){c[t]||(c[t]=[]),c[t].push(e)},removeEventListener:function(t,e){var n=c[t];if(n&&n.length>0)for(var i=n.length;i--;i>0)if(n[i]===e){n.splice(i,1);break}},dispatchEvent:function(t){var e=c[t.type];if(e)for(var n=0;n<e.length;n++)e[n](t)}};e.default=u},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return wx.createImage()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(n(13));var s=0,r=1,a=2,h=3,c=4,u=new WeakMap,l=new WeakMap,p=(new WeakMap,new WeakMap,function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));n.HAVE_NOTHING=s,n.HAVE_METADATA=r,n.HAVE_CURRENT_DATA=a,n.HAVE_FUTURE_DATA=h,n.HAVE_ENOUGH_DATA=c,n.readyState=s,l.set(n,"");var i=wx.createInnerAudioContext();return u.set(n,i),i.onCanplay(function(){n.dispatchEvent({type:"load"}),n.dispatchEvent({type:"loadend"}),n.dispatchEvent({type:"canplay"}),n.dispatchEvent({type:"canplaythrough"}),n.dispatchEvent({type:"loadedmetadata"}),n.readyState=a}),i.onPlay(function(){n.dispatchEvent({type:"play"})}),i.onPause(function(){n.dispatchEvent({type:"pause"})}),i.onEnded(function(){n.dispatchEvent({type:"ended"}),n.readyState=c}),i.onError(function(){n.dispatchEvent({type:"error"})}),t&&(u.get(n).src=t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"load",value:function(){console.warn("HTMLAudioElement.load() is not implemented.")}},{key:"play",value:function(){u.get(this).play()}},{key:"pause",value:function(){u.get(this).pause()}},{key:"canPlayType",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"string"!=typeof t?"":t.indexOf("audio/mpeg")>-1||t.indexOf("audio/mp4")?"probably":""}},{key:"cloneNode",value:function(){var t=new e;return t.loop=u.get(this).loop,t.autoplay=u.get(this).loop,t.src=this.src,t}},{key:"currentTime",get:function(){return u.get(this).currentTime},set:function(t){u.get(this).seek(t)}},{key:"src",get:function(){return l.get(this)},set:function(t){l.set(this,t),u.get(this).src=t}},{key:"loop",get:function(){return u.get(this).loop},set:function(t){u.get(this).loop=t}},{key:"autoplay",get:function(){return u.get(this).autoplay},set:function(t){u.get(this).autoplay=t}},{key:"paused",get:function(){return u.get(this).paused}}]),e}());e.default=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return t&&t.__esModule?t:{default:t}}(n(14));var o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"audio"))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.default),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(n(4));var s=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),e}();e.default=s},function(t,e,n){"use strict";n(16)},function(t,e,n){"use strict";var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=function(t){return t&&t.__esModule?t:{default:t}}(n(10)),s=n(8);var r=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.target=i.canvas,this.currentTarget=i.canvas,this.touches=[],this.targetTouches=[],this.changedTouches=[],this.preventDefault=s.noop,this.stopPropagation=s.noop,this.type=e};function a(t){return function(e){var n=new r(t);n.touches=e.touches,n.targetTouches=Array.prototype.slice.call(e.touches),n.changedTouches=e.changedTouches,n.timeStamp=e.timeStamp,o.default.dispatchEvent(n)}}wx.onTouchStart(a("touchstart")),wx.onTouchMove(a("touchmove")),wx.onTouchEnd(a("touchend")),wx.onTouchCancel(a("touchcancel"))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(8),o={platform:wx.getSystemInfoSync().platform,language:"zh-cn",appVersion:"5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN",onLine:!0,geolocation:{getCurrentPosition:i.noop,watchPosition:i.noop,clearWatch:i.noop}};e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var i=new WeakMap,o=new WeakMap,s=new WeakMap,r=new WeakMap,a=new WeakMap;function h(t){if("function"==typeof this["on"+t]){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this["on"+t].apply(this,n)}}function c(t){this.readyState=t,h.call(this,"readystatechange")}var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,s.set(this,{"content-type":"application/x-www-form-urlencoded"}),r.set(this,{})}return n(t,[{key:"abort",value:function(){var t=a.get(this);t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=r.get(this);return Object.keys(t).map(function(e){return e+": "+t[e]}).join("\n")}},{key:"getResponseHeader",value:function(t){return r.get(this)[t]}},{key:"open",value:function(e,n){o.set(this,e),i.set(this,n),c.call(this,t.OPENED)}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.readyState!==t.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");wx.request({data:n,url:i.get(this),method:o.get(this),header:s.get(this),responseType:this.responseType,success:function(n){var i=n.data,o=n.statusCode,s=n.header;if("string"!=typeof i&&!(i instanceof ArrayBuffer))try{i=JSON.stringify(i)}catch(t){i=i}if(e.status=o,r.set(e,s),h.call(e,"loadstart"),c.call(e,t.HEADERS_RECEIVED),c.call(e,t.LOADING),e.response=i,i instanceof ArrayBuffer){e.responseText="";for(var a=new Uint8Array(i),u=a.byteLength,l=0;l<u;l++)e.responseText+=String.fromCharCode(a[l])}else e.responseText=i;c.call(e,t.DONE),h.call(e,"load"),h.call(e,"loadend")},fail:function(t){var n=t.errMsg;-1!==n.indexOf("abort")?h.call(e,"abort"):h.call(e,"error",n),h.call(e,"loadend")}})}},{key:"setRequestHeader",value:function(t,e){var n=s.get(this);n[t]=e,s.set(this,n)}}]),t}();u.UNSEND=0,u.OPENED=1,u.HEADERS_RECEIVED=2,u.LOADING=3,u.DONE=4,e.default=u},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var i=new WeakMap,o=function(){function t(e){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.binaryType="",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=3,"string"!=typeof e||!/(^ws:\/\/)|(^wss:\/\/)/.test(e))throw new TypeError("Failed to construct 'WebSocket': The URL '"+e+"' is invalid");this.url=e,this.readyState=t.CONNECTING;var s=wx.connectSocket({url:e,protocols:Array.isArray(o)?o:[o]});return i.set(this,s),s.onClose(function(e){n.readyState=t.CLOSED,"function"==typeof n.onclose&&n.onclose(e)}),s.onMessage(function(t){"function"==typeof n.onmessage&&n.onmessage(t)}),s.onOpen(function(){n.readyState=t.OPEN,"function"==typeof n.onopen&&n.onopen()}),s.onError(function(t){"function"==typeof n.onerror&&n.onerror(new Error(t.errMsg))}),this}return n(t,[{key:"close",value:function(e,n){this.readyState=t.CLOSING,i.get(this).close({code:e,reason:n})}},{key:"send",value:function(t){if("string"!=typeof t&&!(t instanceof ArrayBuffer))throw new TypeError("Failed to send message: The data "+t+" is invalid");i.get(this).send({data:t})}}]),t}();o.CONNECTING=0,o.OPEN=1,o.CLOSING=2,o.CLOSED=3,e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={get length(){return wx.getStorageInfoSync().keys.length},key:function(t){return wx.getStorageInfoSync().keys[t]},getItem:function(t){return wx.getStorageSync(t)},setItem:function(t,e){return wx.setStorageSync(t,e)},removeItem:function(t){wx.removeStorageSync(t)},clear:function(){wx.clearStorageSync()}};e.default=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={href:"game.js",reload:function(){}}}])},function(t,e,n){n(1),t.exports=n(0)}]);