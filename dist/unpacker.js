!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){const n=window.zip,r=window.URL||window.webkitURL||window.mozURL;function o(e){return e.replace(/[{}]/gi,"").split(",").map(function(e){return 0|e.trim()})}function i(e,t){const i=e.plist,a=e.image,s=(new DOMParser).parseFromString(i,"text/xml").querySelector("plist dict");if(!s)return;const c=function e(t){switch(t.nodeName){case"string":return t.innerHTML;case"false":return!1;case"true":return!0;case"integer":return 0|t.innerHTML}const n=Object.create(null),r=Array.prototype.slice.call(t.children,0);for(let t=0;t<r.length;){const o=r[t++],i=r[t++];n[o.innerHTML]=e(i)}return n}(s);Object.keys(c.frames).forEach(function(r,i){const s=document.createElement("canvas"),l=s.getContext("2d");e.canvasList.push(s);const u=c.frames[r];u.frame=o(u.frame),u.offset=o(u.offset),u.sourceColorRect=o(u.sourceColorRect),u.sourceSize=o(u.sourceSize);const f=u.sourceSize[0],p=u.sourceSize[1];s.setAttribute("title",r),u.rotated?(s.width=p,s.height=f,l.translate(.5*u.sourceColorRect[0],.5*u.sourceColorRect[1]),l.drawImage(a,u.frame[0],u.frame[1],u.frame[3],u.frame[2],0,0,u.sourceColorRect[3],u.sourceColorRect[2])):(s.width=f,s.height=p,l.clearRect(0,0,f,p),l.drawImage(a,u.frame[0],u.frame[1],u.frame[2],u.frame[3],u.sourceColorRect[0],u.sourceColorRect[1],u.sourceColorRect[2],u.sourceColorRect[3])),t=t.then(function(e){return new Promise(function(t,o){e.add(r,new n.Data64URIReader(s.toDataURL("image/png")),function(){t(e)})})})}),t.then(function(t){t.close(function(t){const n=c.metadata.textureFileName;"string"!=typeof n&&"number"!=typeof n||(e.link=r.createObjectURL(t),e.processing=2)})})}function a(e){e.processing=1;let t=new Promise(function(e,t){n.createWriter(new n.BlobWriter("application/zip"),e,t)});t.then(function(){i(e,t)})}Vue.component("canvas-list",{props:["list"],render(){if(this.list&&this.list.length){const e=document.createDocumentFragment();this.list.forEach(function(t){e.appendChild(t)}),this.$el.parentNode.appendChild(e)}}}),Vue.component("texture-unpacker",{data:()=>({files:[]}),template:'\n            <ul>\n                <li v-for="texture in files">\n                    {{texture.name}}\n                    <p>图片: <span v-text="texture.image ? \'已加载\' : \'未加载\'"></span></p>\n                    <p>plist文件: <span v-text="texture.plist ? \'已加载\' : \'未加载\'"></span></p>\n                    <p v-show="texture.processing == 1">正在生成压缩包...</p>\n                    <p v-show="texture.processing == 2">\n                        <a target="_blank" :download="texture.name + \'.zip\'" :href="texture.link" v-if="texture.link">压缩包已生成, 点我下载</a>\n                    </p>\n                    <button v-if="texture.processing == 2" @click="texture.preview =! texture.preview">预览所有小图</button>\n                    <div class="item" v-show="texture.preview">\n                        <canvas-list :list="texture.canvasList"></canvas-list>\n                    </div>\n                </li>\n            </ul>',mounted(){n.workerScriptsPath="/zip/",this.listen()},methods:{listen(){const e=document;e.addEventListener("dragover",this.handleDragOver,!1),e.addEventListener("drop",this.handleFileSelect.bind(this),!1)},handleDragOver(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},handleFileSelect(e){e.stopPropagation(),e.preventDefault();const t=this.files,n=e.dataTransfer.files;if(0==n.length)return!1;Array.prototype.slice.call(n,0).forEach(function(e){const n=e.name.slice(0,e.name.lastIndexOf("."));let o=!1;t.forEach(function(e){e.name==n&&(o=e)});const i=o||{name:n,image:null,plist:null,canvasList:[],link:null,processing:0,preview:!1};switch(!0){case 0==e.type.indexOf("image"):const t=r.createObjectURL(e),n=new Image;n.onload=function(){r.revokeObjectURL(t),i.image=this,i.plist&&a(i)},n.src=t;break;case e.name.indexOf("plist")>-1:const o=new FileReader;o.onload=function(e){i.plist=e.target.result,i.image&&a(i)},o.readAsText(e);break;default:return}o||t.push(i)})}}}),window.Vue&&new Vue({el:".body"})},function(e,t,n){e.exports=n(0)}]);